
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>compliance_checker.cf.cf_1_6 &#8212; compliance_checker 5.4.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=41d0e7f4"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/compliance_checker/cf/cf_1_6';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="5.4.2" />
    <link rel="canonical" href="https://ioos.github.io/compliance-checker/latest/_modules/compliance_checker/cf/cf_1_6.html" />

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
  <nav class="navbar navbar-dark navbar-expand-lg bg-unidata fixed-top bd-navbar shadow" id="navbar-main">
  </nav>


    <div class="container-fluid" id="banner"></div>


  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../readme_link.html">
    IOOS Compliance Checker
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../compliance_checker_api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../faq.html">
    Frequently Asked Questions
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../development.html">
    Developer Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/ioos/compliance-checker/releases">
    Release Notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ioos/compliance-checker" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
  Version 5.4.2
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdown" id="version-menu"></div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">compliance_checker.cf.cf_1_6</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for compliance_checker.cf.cf_1_6</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">difflib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cftime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">regex</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">compliance_checker.cf.util</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cfutil</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">compliance_checker.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseCheck</span><span class="p">,</span> <span class="n">Result</span><span class="p">,</span> <span class="n">TestCtx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">compliance_checker.cf</span><span class="w"> </span><span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">compliance_checker.cf.appendix_c</span><span class="w"> </span><span class="kn">import</span> <span class="n">valid_modifiers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">compliance_checker.cf.appendix_d</span><span class="w"> </span><span class="kn">import</span> <span class="n">dimless_vertical_coordinates_1_6</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">compliance_checker.cf.appendix_e</span><span class="w"> </span><span class="kn">import</span> <span class="n">cell_methods16</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">compliance_checker.cf.appendix_f</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">grid_mapping_attr_types16</span><span class="p">,</span>
    <span class="n">grid_mapping_dict16</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">compliance_checker.cf.cf_base</span><span class="w"> </span><span class="kn">import</span> <span class="n">CFNCCheck</span><span class="p">,</span> <span class="n">appendix_a_base</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">compliance_checker.cfunits</span><span class="w"> </span><span class="kn">import</span> <span class="n">Unit</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="CF1_6Check">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CF1_6Check</span><span class="p">(</span><span class="n">CFNCCheck</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;CF-1.6-specific implementation of CFBaseCheck; supports checking</span>
<span class="sd">    netCDF datasets.</span>
<span class="sd">    These checks are translated documents:</span>
<span class="sd">        https://cfconventions.org/cf-conventions/v1.6.0/cf-conventions.html&quot;&quot;&quot;</span>

    <span class="n">register_checker</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_cc_spec</span> <span class="o">=</span> <span class="s2">&quot;cf&quot;</span>
    <span class="n">_cc_spec_version</span> <span class="o">=</span> <span class="s2">&quot;1.6&quot;</span>
    <span class="n">_cc_description</span> <span class="o">=</span> <span class="s2">&quot;Climate and Forecast Conventions (CF)&quot;</span>
    <span class="n">_cc_url</span> <span class="o">=</span> <span class="s2">&quot;http://cfconventions.org/cf-conventions/v1.6.0/cf-conventions.html&quot;</span>
    <span class="n">_cc_display_headers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;Errors&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;Warnings&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Info&quot;</span><span class="p">}</span>
    <span class="n">appendix_a</span> <span class="o">=</span> <span class="n">appendix_a_base</span>
    <span class="n">appendix_d_parametric_coords</span> <span class="o">=</span> <span class="n">dimless_vertical_coordinates_1_6</span>
    <span class="n">_allowed_numeric_var_types</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span>  <span class="c1"># &quot;|S1&quot; dtype, byte array used as string</span>
        <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
    <span class="p">}</span>

<div class="viewcode-block" id="CF1_6Check.__init__">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># initialize with parent methods and data</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cell_methods</span> <span class="o">=</span> <span class="n">cell_methods16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_mapping_dict</span> <span class="o">=</span> <span class="n">grid_mapping_dict16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_mapping_attr_types</span> <span class="o">=</span> <span class="n">grid_mapping_attr_types16</span></div>


    <span class="c1">###############################################################################</span>
    <span class="c1"># Chapter 2: NetCDF Files and Components</span>
    <span class="c1">###############################################################################</span>
<div class="viewcode-block" id="CF1_6Check.check_filename">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_filename">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks that the filename ends with .nc&quot;&quot;&quot;</span>
        <span class="c1"># IMPLEMENTS CONFORMANCE 2.1</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">filepath</span><span class="p">()</span>
        <span class="n">filename_suffix</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.1&quot;</span><span class="p">])</span>
        <span class="n">filename_suffix</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">filepath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;nc&quot;</span><span class="p">),</span>
            <span class="sa">f</span><span class="s1">&#39;Dataset path </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1"> must end with &quot;.nc&quot;&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">filename_suffix</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span></div>


<div class="viewcode-block" id="CF1_6Check.check_data_types">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_data_types">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_data_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the data type of all netCDF variables to ensure they are valid</span>
<span class="sd">        data types under CF.</span>

<span class="sd">        CF §2.2 The netCDF data types char, byte, short, int, float or real, and</span>
<span class="sd">        double are all acceptable</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># IMPLEMENTS CONFORMANCE 2.2</span>
        <span class="n">fails</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">v</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span>
                <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">!=</span> <span class="s2">&quot;S&quot;</span>
                <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowed_numeric_var_types</span>
            <span class="p">):</span>
                <span class="n">fails</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The variable </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> failed because the datatype is </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">datatype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span>
            <span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">fails</span><span class="p">),</span> <span class="n">total</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.2&quot;</span><span class="p">],</span>
            <span class="n">msgs</span><span class="o">=</span><span class="n">fails</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CF1_6Check.check_child_attr_data_types">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_child_attr_data_types">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_child_attr_data_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For any variables which contain any of the following attributes:</span>
<span class="sd">            - valid_min/valid_max</span>
<span class="sd">            - valid_range</span>
<span class="sd">            - scale_factor</span>
<span class="sd">            - add_offset</span>
<span class="sd">            - _FillValue</span>
<span class="sd">        the data type of the attribute must match the type of its parent variable as specified in the</span>
<span class="sd">        NetCDF User Guide (NUG) https://docs.unidata.ucar.edu/netcdf-c/current/attribute_conventions.html,</span>
<span class="sd">        referenced in the CF Conventions in Section 2.5.2</span>
<span class="sd">        (http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#missing-data)</span>

<span class="sd">        :param netCDF4.Dataset ds: open netCDF dataset object</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ctx</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.5&quot;</span><span class="p">])</span>
        <span class="n">special_attrs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;actual_range&quot;</span><span class="p">,</span>
            <span class="s2">&quot;valid_min&quot;</span><span class="p">,</span>
            <span class="s2">&quot;valid_max&quot;</span><span class="p">,</span>
            <span class="s2">&quot;valid_range&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_FillValue&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">_var_name</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">att_name</span> <span class="ow">in</span> <span class="n">special_attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">att_name</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_parent_var_attr_type_check</span><span class="p">(</span><span class="n">att_name</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span></div>


    <span class="c1"># TODO: consider renaming to avoid confusion with non-underscore</span>
    <span class="c1">#       primary function version</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_add_offset_scale_factor_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reusable function for checking both add_offset and scale_factor.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">msgs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">float_msg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> must be equivalent &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;data types or </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be of type byte, short, or int &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;and </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> must be float or double&quot;</span>
        <span class="p">)</span>

        <span class="n">att</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">att</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">number</span> <span class="o">|</span> <span class="nb">float</span><span class="p">))):</span>  <span class="c1"># can&#39;t compare dtypes</span>
            <span class="n">val</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">same_type</span> <span class="o">=</span> <span class="n">att</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span>
            <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">same_type</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>  <span class="c1"># will short-circuit or if first condition is true</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">att</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span> <span class="o">|</span> <span class="nb">float</span><span class="p">))</span>
                <span class="ow">and</span> <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">byte</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">short</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span><span class="p">:</span>
            <span class="n">msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">same_type</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">att</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="ow">and</span> <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">):</span>
            <span class="n">float_msg</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;When </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> is of type float, the variable </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> must not be an integer type&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Result</span><span class="p">(</span>
                <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="p">(</span><span class="ow">not</span> <span class="n">float_msg</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;8.1&quot;</span><span class="p">],</span>
                <span class="n">float_msg</span><span class="p">,</span>
                <span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Result</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;8.1&quot;</span><span class="p">],</span> <span class="n">msgs</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

<div class="viewcode-block" id="CF1_6Check.check_add_offset_scale_factor_type">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_add_offset_scale_factor_type">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_add_offset_scale_factor_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If a variable has the attributes add_offset and scale_factor,</span>
<span class="sd">        check that the variables and attributes are of the same type</span>
<span class="sd">        OR that the variable is of type byte, short or int and the</span>
<span class="sd">        attributes are of type float or double.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">add_offset_vars</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span>
            <span class="n">add_offset</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scale_factor_vars</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span>
            <span class="n">scale_factor</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">both</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">add_offset_vars</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">scale_factor_vars</span><span class="p">)</span>
        <span class="n">both_msgs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">both_var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">both</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">var</span><span class="p">:</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">both_var</span><span class="o">.</span><span class="n">scale_factor</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">both_var</span><span class="o">.</span><span class="n">add_offset</span><span class="o">.</span><span class="n">dtype</span><span class="p">:</span>
                <span class="n">both_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;When both scale_factor and add_offset &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;are supplied for variable </span><span class="si">{</span><span class="n">both_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="s2">&quot;they must have the same type&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Result</span><span class="p">(</span>
                <span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">both_msgs</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;8.1&quot;</span><span class="p">],</span>
                <span class="n">both_msgs</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">_att_vars_tup</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;add_offset&quot;</span><span class="p">,</span> <span class="n">add_offset_vars</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">,</span> <span class="n">scale_factor_vars</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">_att_vars_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_add_offset_scale_factor_type</span><span class="p">(</span>
                        <span class="n">var</span><span class="p">,</span>
                        <span class="n">_att_vars_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">),</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="CF1_6Check.check_naming_conventions">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_naming_conventions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_naming_conventions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the variable names to ensure they are valid CF variable names under CF.</span>

<span class="sd">        CF §2.3 Variable, dimension and attribute names should begin with a letter</span>
<span class="sd">        and be composed of letters, digits, and underscores.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">variable_naming</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.3&quot;</span><span class="p">])</span>
        <span class="n">dimension_naming</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.3&quot;</span><span class="p">])</span>
        <span class="n">attribute_naming</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.3&quot;</span><span class="p">])</span>

        <span class="n">ignore_attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;_FillValue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DODS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_ChunkSizes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_Coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_Unsigned&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_Encoding&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">rname</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^[A-Za-z][A-Za-z0-9_]*$&quot;</span><span class="p">)</span>

        <span class="c1"># IMPLEMENTATION CONFORMANCE 2.3 REQUIRED</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">variable_naming</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">rname</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;variable </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> should begin with a letter and be composed of &quot;</span>
                <span class="s2">&quot;letters, digits, and underscores&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Keep track of all the attributes, we&#39;ll need to check them</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">variable</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">ignore_attributes</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># Special attributes made by THREDDS</span>
                <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;DODS&quot;</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="c1"># Ignore model produced attributes</span>
                <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_Coordinate&quot;</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">attribute_naming</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="n">rname</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;attribute </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2"> should begin with a letter and be composed of &quot;</span>
                    <span class="s2">&quot;letters, digits, and underscores&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variable_naming</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="n">dimension_naming</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">rname</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;dimension </span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2"> should begin with a latter and be composed of &quot;</span>
                <span class="s2">&quot;letters, digits, and underscores&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dimension_naming</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">global_attr</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
            <span class="c1"># Special attributes made by THREDDS</span>
            <span class="k">if</span> <span class="n">global_attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;DODS&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">global_attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;EXTRA_DIMENSION&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">attribute_naming</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">rname</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">global_attr</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;global attribute </span><span class="si">{</span><span class="n">global_attr</span><span class="si">}</span><span class="s2"> should begin with a letter and be composed of &quot;</span>
                <span class="s2">&quot;letters, digits, and underscores&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attribute_naming</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_names_unique">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_names_unique">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_names_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the variable names for uniqueness regardless of case.</span>

<span class="sd">        CF §2.3 names should not be distinguished purely by case, i.e., if case</span>
<span class="sd">        is disregarded, no two names should be the same.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fails</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># IMPLEMENTATION CONFORMANCE 2.3 RECOMMENDED</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="n">names</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">fails</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;Variables are not case sensitive. Duplicate variables named: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">names</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span>
            <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
            <span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">fails</span><span class="p">),</span> <span class="n">total</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.3&quot;</span><span class="p">],</span>
            <span class="n">msgs</span><span class="o">=</span><span class="n">fails</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CF1_6Check.check_dimension_names">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_dimension_names">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_dimension_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks variables contain no duplicate dimension names.</span>

<span class="sd">        CF §2.4 A variable may have any number of dimensions, including zero,</span>
<span class="sd">        and the dimensions must all have different names.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fails</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="n">dims</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># IMPLEMENTATION CONFORMANCE 2.4 REQUIRED</span>
            <span class="k">for</span> <span class="n">dimension</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">dims</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fails</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> has two or more dimensions named </span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span>
            <span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">fails</span><span class="p">),</span> <span class="n">total</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.4&quot;</span><span class="p">],</span>
            <span class="n">msgs</span><span class="o">=</span><span class="n">fails</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CF1_6Check.check_dimension_order">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_dimension_order">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_dimension_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks each variable&#39;s dimension order to ensure that the order is</span>
<span class="sd">        consistent and in order under CF §2.4</span>

<span class="sd">        CF §2.4 If any or all of the dimensions of a variable have the</span>
<span class="sd">        interpretations of &quot;date or time&quot; (T), &quot;height or depth&quot; (Z),</span>
<span class="sd">        &quot;latitude&quot; (Y), or &quot;longitude&quot; (X) then we recommend, those dimensions</span>
<span class="sd">        to appear in the relative order T, then Z, then Y, then X in the CDL</span>
<span class="sd">        definition corresponding to the file. All other dimensions should,</span>
<span class="sd">        whenever possible, be placed to the left of the spatiotemporal</span>
<span class="sd">        dimensions.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_dimension_order</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.4&quot;</span><span class="p">])</span>
        <span class="c1"># Build a map from coordinate variable to axis</span>
        <span class="n">coord_axis_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coord_axis_map</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="c1"># Check each variable&#39;s dimension order, excluding climatology and</span>
        <span class="c1"># bounds variables</span>
        <span class="n">any_clim</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_climatology_variable</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">any_bounds</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_cell_boundary_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Skip bounds/climatology variables, as they should implicitly</span>
            <span class="c1"># have the same order except for the bounds specific dimension.</span>
            <span class="c1"># This is tested later in the respective checks</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">any_bounds</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="n">any_clim</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Skip strings/labels</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;char&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="n">dimension_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dimension_order</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">coord_axis_map</span><span class="p">)</span>
                <span class="n">valid_dimension_order</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dims_in_order</span><span class="p">(</span><span class="n">dimension_order</span><span class="p">),</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&#39;s spatio-temporal dimensions are not in the &quot;</span>
                    <span class="s2">&quot;recommended order T, Z, Y, X and/or further dimensions &quot;</span>
                    <span class="s2">&quot;are not located left of T, Z, Y, X. The dimensions (and &quot;</span>
                    <span class="s2">&quot;their guessed types) are </span><span class="si">{}</span><span class="s2"> (with U: other/unknown; L: &quot;</span>
                    <span class="s2">&quot;unlimited).&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">name</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_pretty_dimension_order_with_type</span><span class="p">(</span>
                            <span class="n">ds</span><span class="p">,</span>
                            <span class="n">name</span><span class="p">,</span>
                            <span class="n">dimension_order</span><span class="p">,</span>
                        <span class="p">),</span>
                    <span class="p">),</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">valid_dimension_order</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span></div>


<div class="viewcode-block" id="CF1_6Check.check_fill_value_equal_missing_value">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_fill_value_equal_missing_value">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_fill_value_equal_missing_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If both missing_value and _FillValue be used, they should have the same value.</span>
<span class="sd">        This according to CF §2.5.1 Recommendations:</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of Results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fails</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="c1"># If the variable have a defined _FillValue a defined missing_value check it.</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;_FillValue&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;missing_value&quot;</span><span class="p">):</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">total</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                    <span class="n">variable</span><span class="o">.</span><span class="n">_FillValue</span> <span class="o">==</span> <span class="n">variable</span><span class="o">.</span><span class="n">missing_value</span>
                    <span class="ow">or</span> <span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">_FillValue</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">missing_value</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">fails</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;For the variable </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> the missing_value must be equal to the _FillValue&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span>
            <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
            <span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">fails</span><span class="p">),</span> <span class="n">total</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.5&quot;</span><span class="p">],</span>
            <span class="n">msgs</span><span class="o">=</span><span class="n">fails</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CF1_6Check.check_valid_range_and_valid_min_max_present">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_valid_range_and_valid_min_max_present">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_valid_range_and_valid_min_max_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The valid_range attribute must not be present if the valid_min</span>
<span class="sd">        and/or valid_max attributes are present. This according to 2.5.1 Requirements.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of Results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fails</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;valid_max&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;valid_min&quot;</span><span class="p">):</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># if there&#39;s also valid_range in addition to</span>
                <span class="c1"># valid_min/valid_max, this is not compliant</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;valid_range&quot;</span><span class="p">):</span>
                    <span class="n">fails</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;For the variable </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> the valid_range attribute must not be present &quot;</span>
                        <span class="s2">&quot;if the valid_min and/or valid_max attributes are present&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="c1"># *Just* valid_range should be added to total as well</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;valid_range&quot;</span><span class="p">):</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span>
            <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
            <span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">fails</span><span class="p">),</span> <span class="n">total</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.5&quot;</span><span class="p">],</span>
            <span class="n">msgs</span><span class="o">=</span><span class="n">fails</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CF1_6Check.check_fill_value_outside_valid_range">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_fill_value_outside_valid_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_fill_value_outside_valid_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks each variable&#39;s _FillValue to ensure that it&#39;s in valid_range or</span>
<span class="sd">        between valid_min and valid_max according to CF §2.5.1</span>

<span class="sd">        CF §2.5.1 The _FillValue should be outside the range specified by</span>
<span class="sd">        valid_range (if used) for a variable.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of Results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_fill_range</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.5&quot;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># If the variable doesn&#39;t have a defined _FillValue don&#39;t check it.</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;_FillValue&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">fill_value</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">_FillValue</span>

            <span class="n">attrs</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">()</span>

            <span class="k">if</span> <span class="s2">&quot;valid_range&quot;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">valid_range</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;§2.5.1 Fill Values should be outside the range specified by valid_range&quot;</span>  <span class="c1"># subsection message</span>
                    <span class="n">valid_fill_range</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                        <span class="kc">False</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">;</span><span class="se">\n\t</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:valid_range must be a numeric type not a string&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">valid_range</span>
                <span class="n">spec_by</span> <span class="o">=</span> <span class="s2">&quot;valid_range&quot;</span>

            <span class="k">elif</span> <span class="s2">&quot;valid_min&quot;</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="ow">and</span> <span class="s2">&quot;valid_max&quot;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">valid_min</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">valid_fill_range</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                        <span class="kc">False</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:valid_min must be a numeric type not a string&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">valid_max</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">valid_fill_range</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                        <span class="kc">False</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:valid_max must be a numeric type not a string&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">valid_min</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">variable</span><span class="o">.</span><span class="n">valid_max</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">rmin</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">valid_min</span>
                <span class="n">rmax</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">valid_max</span>
                <span class="n">spec_by</span> <span class="o">=</span> <span class="s2">&quot;valid_min/valid_max&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fill_value</span><span class="p">):</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="n">fill_value</span> <span class="o">&lt;</span> <span class="n">rmin</span> <span class="ow">or</span> <span class="n">fill_value</span> <span class="o">&gt;</span> <span class="n">rmax</span>

            <span class="n">valid_fill_range</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">valid</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:_FillValue (</span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2">) should be outside the range specified by </span><span class="si">{</span><span class="n">spec_by</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">rmin</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">rmax</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">valid_fill_range</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span></div>


<div class="viewcode-block" id="CF1_6Check.check_convention_globals">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_convention_globals">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_convention_globals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the common global attributes are strings if they exist.</span>

<span class="sd">        CF §2.6.2 title/history global attributes, must be strings. Do not need</span>
<span class="sd">        to exist.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of Results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;history&quot;</span><span class="p">]</span>

        <span class="n">valid_globals</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.6&quot;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">dataset_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">is_string</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_attr</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">valid_globals</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">is_string</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_attr</span><span class="p">),</span>
                <span class="sa">f</span><span class="s2">&quot;§2.6.2 global attribute </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2"> should exist and be a non-empty string&quot;</span>  <span class="c1"># subsection message</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">valid_globals</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span></div>


    <span class="c1"># IMPLEMENTATION CONFORMANCE 1.2</span>
<div class="viewcode-block" id="CF1_6Check.check_coordinate_variables_strict_monotonicity">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_coordinate_variables_strict_monotonicity">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_coordinate_variables_strict_monotonicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that data in coordinate variables is either monotonically</span>
<span class="sd">        increasing or decreasing</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">coord_var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_coord_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
            <span class="n">coord_var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">coord_var_name</span><span class="p">]</span>
            <span class="n">arr_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">coord_var</span><span class="p">)</span>
            <span class="n">monotonicity</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;1.2&quot;</span><span class="p">])</span>
            <span class="n">monotonicity</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">arr_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">arr_diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span>
                <span class="sa">f</span><span class="s1">&#39;Coordinate variable &quot;</span><span class="si">{</span><span class="n">coord_var_name</span><span class="si">}</span><span class="s1">&quot; must be strictly monotonic&#39;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">monotonicity</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_convention_possibly_var_attrs">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_convention_possibly_var_attrs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_convention_possibly_var_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check variable and global attributes are strings for recommended attributes under CF §2.6.2</span>

<span class="sd">        CF §2.6.2 institution, source, references, and comment, either global</span>
<span class="sd">        or assigned to individual variables.  When an attribute appears both</span>
<span class="sd">        globally and as a variable attribute, the variable&#39;s version has</span>
<span class="sd">        precedence.  Must be strings.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of Results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The attrs are optional and only needs to be a string and non-empty if it</span>
        <span class="c1"># exists.</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;institution&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="s2">&quot;references&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">]</span>

        <span class="n">valid_attributes</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.6&quot;</span><span class="p">])</span>

        <span class="n">attr_bin</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># If the attribute is defined for any variable, check it and mark in</span>
        <span class="c1"># the set that we&#39;ve seen it at least once.</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">variable</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
                <span class="n">varattr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                    <span class="n">is_string</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">varattr</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                    <span class="n">valid_attributes</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                        <span class="n">is_string</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">varattr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;§2.6.2 </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> should be a non-empty string&quot;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">attr_bin</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>

        <span class="c1"># Check all the global attributes too and mark if we&#39;ve seen them</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
            <span class="n">dsattr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">is_string</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dsattr</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                <span class="n">valid_attributes</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="n">is_string</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dsattr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;§2.6.2 </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> global attribute should be a non-empty string&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">attr_bin</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">valid_attributes</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span></div>


    <span class="c1">###############################################################################</span>
    <span class="c1"># Chapter 3: Description of the Data</span>
    <span class="c1">###############################################################################</span>

<div class="viewcode-block" id="CF1_6Check.check_units">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_units">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the units attribute for all variables to ensure they are CF</span>
<span class="sd">        compliant under CF §3.1</span>

<span class="sd">        CF §3.1 The units attribute is required for all variables that represent dimensional quantities</span>
<span class="sd">        (except for boundary variables defined in Section 7.1, &quot;Cell Boundaries&quot; and climatology variables</span>
<span class="sd">        defined in Section 7.4, &quot;Climatological Statistics&quot;).</span>

<span class="sd">        Units are not required for dimensionless quantities. A variable with no units attribute is assumed</span>
<span class="sd">        to be dimensionless. However, a units attribute specifying a dimensionless unit may optionally be</span>
<span class="sd">        included.</span>

<span class="sd">        - units required</span>
<span class="sd">        - type must be recognized by udunits</span>
<span class="sd">        - if standard name specified, must be consistent with standard name table, must also be consistent with a</span>
<span class="sd">          specified cell_methods attribute if present</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">coordinate_variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_coord_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">auxiliary_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_aux_coord_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">geophysical_variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_geophysical_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">modifier_variables</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">_find_standard_name_modifier_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">forecast_variables</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_forecast_metadata_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="n">dimless_vert</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">var</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span>
                <span class="n">standard_name</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">appendix_d_parametric_coords</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1"># check anything remaining that has units</span>
        <span class="c1"># unit_containing =</span>
        <span class="n">unit_required_variables</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="n">coordinate_variables</span>
                <span class="o">+</span> <span class="n">auxiliary_coordinates</span>
                <span class="o">+</span> <span class="n">geophysical_variables</span>
                <span class="o">+</span> <span class="n">forecast_variables</span>
                <span class="o">+</span> <span class="n">modifier_variables</span><span class="p">,</span>
            <span class="p">)</span>  <span class="c1"># standard names with modifiers require proper units, *except* for flags, where they should not be present</span>
            <span class="o">-</span> <span class="n">dimless_vert</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">unit_required_variables</span><span class="p">:</span>
            <span class="c1"># For reduced horizontal grids, the compression index variable does</span>
            <span class="c1"># not require units.</span>
            <span class="k">if</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">is_compression_coordinate</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

            <span class="c1"># Skip instance coordinate variables</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;cf_role&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Skip labels</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;char&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">standard_name</span><span class="p">,</span> <span class="n">standard_name_modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_standard_name</span><span class="p">(</span>
                <span class="n">standard_name</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">valid_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_valid_cf_units</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_units</span><span class="p">)</span>

            <span class="n">units_attr_is_string</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.1&quot;</span><span class="p">])</span>

            <span class="c1"># side effects, but better than teasing out the individual result</span>
            <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">units_attr_is_string</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                <span class="sa">f</span><span class="s2">&quot;units (</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">) attribute of &#39;</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; must be a string compatible with UDUNITS&quot;</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">valid_udunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_valid_udunits</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_udunits</span><span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">units_attr_is_string</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">standard_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># CONFORMANCE 3.1 REQUIRED</span>
                <span class="n">valid_standard_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_valid_standard_units</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_standard_units</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_valid_cf_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that the variable contains units attribute, the attribute is a</span>
<span class="sd">        string and the value is not deprecated by CF</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :param str variable_name: Name of the variable to be checked</span>
<span class="sd">        :rtype:</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This list is straight from section 3</span>
        <span class="n">deprecated</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma_level&quot;</span><span class="p">]</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>

        <span class="n">valid_units</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.1&quot;</span><span class="p">])</span>
        <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">standard_name_full</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">standard_name</span><span class="p">,</span> <span class="n">standard_name_modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_standard_name</span><span class="p">(</span>
            <span class="n">standard_name_full</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">std_name_units_dimensionless</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">is_dimensionless_standard_name</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_std_names</span><span class="o">.</span><span class="n">_root</span><span class="p">,</span>
            <span class="n">standard_name</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># 3) units are not deprecated</span>
        <span class="n">valid_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">deprecated</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;units for </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s1">, &quot;</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s1">&quot; are deprecated by CF 1.6&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># 4/5) Modifiers, if present, have the appropriate units, or none for</span>
        <span class="c1">#    status_flag</span>
        <span class="k">if</span> <span class="n">standard_name_modifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">standard_name_modifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_modifiers</span><span class="p">:</span>
                <span class="c1"># standard name modifier warning given elsewhere</span>
                <span class="k">return</span> <span class="n">valid_units</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unit_type</span> <span class="o">=</span> <span class="n">valid_modifiers</span><span class="p">[</span><span class="n">standard_name_modifier</span><span class="p">]</span>
        <span class="c1"># no modifiers, just check against standard name canonical_units</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit_type</span> <span class="o">=</span> <span class="s2">&quot;u&quot;</span>

        <span class="k">if</span> <span class="n">unit_type</span> <span class="o">==</span> <span class="s2">&quot;u&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_std_names</span><span class="p">[</span><span class="n">standard_name</span><span class="p">]</span><span class="o">.</span><span class="n">canonical_units</span>
            <span class="c1"># if standard name isn&#39;t found, there won&#39;t be an associated units</span>
            <span class="c1"># but a standard name error will be raised elsewhere</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">valid_units</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">unit_type</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
            <span class="n">reference</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
        <span class="k">elif</span> <span class="n">unit_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">valid_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;units attribute for variable </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> must be unset &quot;</span>
                <span class="s2">&quot;when status_flag standard name modifier is set&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">valid_units</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

        <span class="c1"># Is this even in the database? also, if there is no standard_name,</span>
        <span class="c1"># there&#39;s no way to know if it is dimensionless.</span>
        <span class="n">should_be_dimensionless</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="nb">str</span>
            <span class="ow">or</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;char&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">std_name_units_dimensionless</span>
            <span class="ow">or</span> <span class="n">standard_name</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="c1"># 1) Units must exist</span>
        <span class="n">valid_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">should_be_dimensionless</span> <span class="ow">or</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;units attribute is required for </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> when variable is not a dimensionless quantity&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Don&#39;t bother checking the rest</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">should_be_dimensionless</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valid_units</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>
        <span class="c1"># 2) units attribute must be a string</span>
        <span class="n">valid_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">should_be_dimensionless</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
            <span class="sa">f</span><span class="s2">&quot;units attribute for </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> needs to be a string&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">units_conv</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">valid_units</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Unit string &quot;</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s1">&quot; is not recognized by UDUnits&#39;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">valid_units</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">valid_units</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid_units</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">valid_units</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># time and forecast_reference time have special unit handling rules</span>
        <span class="c1"># that use time relative to a reference point, despite canonical units</span>
        <span class="c1"># being expressed as &quot;s&quot;/seconds</span>
        <span class="k">if</span> <span class="n">standard_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;forecast_reference_time&quot;</span><span class="p">}:</span>
            <span class="n">valid_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">units_conv</span><span class="o">.</span><span class="n">is_convertible</span><span class="p">(</span><span class="n">Unit</span><span class="p">(</span><span class="n">reference</span><span class="p">)),</span>
                <span class="sa">f</span><span class="s1">&#39;Units &quot;</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s1">&quot; for variable &#39;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> must be convertible to &quot;</span>
                <span class="sa">f</span><span class="s1">&#39;canonical units &quot;</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">valid_units</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_valid_udunits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that the variable&#39;s units are contained in UDUnits</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :param str variable_name: Name of the variable to be checked</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>

        <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">standard_name</span><span class="p">,</span> <span class="n">standard_name_modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_standard_name</span><span class="p">(</span><span class="n">standard_name</span><span class="p">)</span>
        <span class="n">std_name_units_dimensionless</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">is_dimensionless_standard_name</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_std_names</span><span class="o">.</span><span class="n">_root</span><span class="p">,</span>
            <span class="n">standard_name</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># If the variable is supposed to be dimensionless, it automatically passes</span>
        <span class="n">should_be_dimensionless</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="nb">str</span>
            <span class="ow">or</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;char&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">std_name_units_dimensionless</span>
        <span class="p">)</span>

        <span class="n">valid_udunits</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.1&quot;</span><span class="p">])</span>
        <span class="n">are_udunits</span> <span class="o">=</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">util</span><span class="o">.</span><span class="n">units_known</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
        <span class="n">valid_udunits</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">should_be_dimensionless</span> <span class="ow">or</span> <span class="n">are_udunits</span> <span class="ow">or</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;units for </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s1">, &quot;</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s1">&quot; are not recognized by UDUNITS&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">valid_udunits</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_valid_standard_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that the variable&#39;s units are appropriate for the standard name</span>
<span class="sd">        according to the CF standard name table and coordinate sections in CF</span>
<span class="sd">        1.6</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :param str variable_name: Name of the variable to be checked</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>
        <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">valid_standard_units</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.1&quot;</span><span class="p">])</span>

        <span class="c1"># If the variable is supposed to be dimensionless, it automatically passes</span>
        <span class="n">std_name_units_dimensionless</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">is_dimensionless_standard_name</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_std_names</span><span class="o">.</span><span class="n">_root</span><span class="p">,</span>
            <span class="n">standard_name</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">std_name_units_dimensionless</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valid_standard_units</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

        <span class="n">standard_name</span><span class="p">,</span> <span class="n">standard_name_modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_standard_name</span><span class="p">(</span><span class="n">standard_name</span><span class="p">)</span>

        <span class="c1"># Other standard_name modifiers have the same units as the</span>
        <span class="c1"># unmodified standard name or are not checked for units.</span>

        <span class="c1"># number_of_observations is a special case which always must be units</span>
        <span class="c1"># of &quot;1&quot;</span>
        <span class="k">if</span> <span class="n">standard_name_modifier</span> <span class="o">==</span> <span class="s2">&quot;number_of_observations&quot;</span><span class="p">:</span>
            <span class="n">valid_standard_units</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">units</span> <span class="o">!=</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;When variable </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> has a &quot;</span>
                    <span class="s2">&quot;standard name modifier of number_of_observations, &quot;</span>
                    <span class="s2">&quot;the specified units must be 1&quot;</span>
                <span class="p">)</span>
                <span class="n">valid_standard_units</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valid_standard_units</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># number_of_observations should short circuit and not continue</span>
            <span class="c1"># on to further units checks</span>
            <span class="k">return</span> <span class="n">valid_standard_units</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">standard_name_modifier</span> <span class="o">==</span> <span class="s2">&quot;status_flag&quot;</span><span class="p">:</span>
            <span class="c1"># no units required - skip further checks</span>
            <span class="k">return</span> <span class="n">valid_standard_units</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

        <span class="c1"># This section represents the different cases where simple udunits</span>
        <span class="c1"># comparison isn&#39;t comprehensive enough to determine if the units are</span>
        <span class="c1"># appropriate under CF</span>

        <span class="c1"># UDUnits accepts &quot;s&quot; as a unit of time but it should be &lt;unit&gt; since &lt;epoch&gt;</span>
        <span class="c1"># TODO: forecast_reference_time.  Include upcoming merge.</span>
        <span class="c1"># IMPLEMENTATION CONFORMANCE 4.4 REQUIRED 1/2</span>
        <span class="k">elif</span> <span class="n">standard_name</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
            <span class="n">valid_standard_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">cfutil</span><span class="o">.</span><span class="n">units_convertible</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="s2">&quot;seconds since 1970-01-01&quot;</span><span class="p">),</span>
                <span class="s2">&quot;time must be in a valid units format &lt;unit&gt; since &lt;epoch&gt; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;not </span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># UDunits can&#39;t tell the difference between east and north facing coordinates</span>
        <span class="k">elif</span> <span class="n">standard_name</span> <span class="o">==</span> <span class="s2">&quot;latitude&quot;</span><span class="p">:</span>
            <span class="c1"># degrees is allowed if using a transformed grid</span>
            <span class="n">allowed_units</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">VALID_LAT_UNITS</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;degrees&quot;</span><span class="p">}</span>
            <span class="n">valid_standard_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">allowed_units</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;variables defining latitude (&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s1">&quot;) must use degrees_north &#39;</span>
                <span class="s2">&quot;or degrees if defining a transformed grid. Currently &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># UDunits can&#39;t tell the difference between east and north facing coordinates</span>
        <span class="k">elif</span> <span class="n">standard_name</span> <span class="o">==</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span>
            <span class="c1"># degrees is allowed if using a transformed grid</span>
            <span class="n">allowed_units</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">VALID_LON_UNITS</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;degrees&quot;</span><span class="p">}</span>
            <span class="n">valid_standard_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">allowed_units</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;variables defining longitude (&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s1">&quot;) must use degrees_east &#39;</span>
                <span class="s2">&quot;or degrees if defining a transformed grid. Currently &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">valid_standard_units</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

<div class="viewcode-block" id="CF1_6Check.check_standard_name">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_standard_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_standard_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check a variables&#39;s standard_name attribute to ensure that it meets CF</span>
<span class="sd">        compliance.</span>

<span class="sd">        CF §3.3 A standard name is associated with a variable via the attribute</span>
<span class="sd">        standard_name which takes a string value comprised of a standard name</span>
<span class="sd">        optionally followed by one or more blanks and a standard name modifier</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">coord_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_coord_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">aux_coord_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_aux_coord_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">axis_vars</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_axis_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">flag_vars</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_flag_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">geophysical_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_geophysical_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="n">variables_requiring_standard_names</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">coord_vars</span> <span class="o">+</span> <span class="n">aux_coord_vars</span> <span class="o">+</span> <span class="n">axis_vars</span> <span class="o">+</span> <span class="n">flag_vars</span> <span class="o">+</span> <span class="n">geophysical_vars</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">variables_requiring_standard_names</span><span class="p">):</span>
            <span class="c1"># Compression indices used in reduced horizontal grids or</span>
            <span class="c1"># compression schemes do not require attributes other than compress</span>
            <span class="k">if</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">is_compression_coordinate</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">ncvar</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

            <span class="c1"># §9 doesn&#39;t explicitly allow instance variables as coordinates but</span>
            <span class="c1"># it&#39;s loosely implied. Just in case, skip it.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ncvar</span><span class="p">,</span> <span class="s2">&quot;cf_role&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Unfortunately, §6.1 allows for string types to be listed as</span>
            <span class="c1"># coordinates.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ncvar</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;char&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ncvar</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">ncvar</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ncvar</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">standard_name</span><span class="p">,</span> <span class="n">standard_name_modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_standard_name</span><span class="p">(</span>
                <span class="n">standard_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">long_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ncvar</span><span class="p">,</span> <span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">long_or_std_name</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.3&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">long_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">long_name_present</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">long_or_std_name</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">long_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                    <span class="sa">f</span><span class="s2">&quot;Attribute long_name for variable </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be a string&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">long_name_present</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># §1.3 The long_name and standard_name attributes are used to</span>
            <span class="c1"># describe the content of each variable. For backwards</span>
            <span class="c1"># compatibility with COARDS neither is required, but use of at</span>
            <span class="c1"># least one of them is strongly recommended.</span>

            <span class="c1"># If standard_name is not defined but long_name is, don&#39;t continue</span>
            <span class="c1"># the check for this variable</span>
            <span class="c1"># IMPLEMENTATION CONFORMANCE 3.3 REQUIRED 1, 2, 3 / 3</span>
            <span class="k">if</span> <span class="n">standard_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">standard_name_present</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">valid_std_name</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.3&quot;</span><span class="p">])</span>
                <span class="n">valid_std_name</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">standard_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                    <span class="sa">f</span><span class="s2">&quot;Attribute standard_name for variable </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be a string&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">valid_std_name</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">standard_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_std_names</span><span class="p">:</span>
                    <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;standard_name </span><span class="si">{}</span><span class="s2"> is not defined in Standard Name Table v</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">standard_name</span> <span class="ow">or</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_std_names</span><span class="o">.</span><span class="n">_version</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">close_matches</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">get_close_matches</span><span class="p">(</span>
                        <span class="n">standard_name</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_std_names</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">close_matches</span><span class="p">:</span>
                        <span class="n">err_msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; Possible close match(es): </span><span class="si">{</span><span class="n">close_matches</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">valid_std_name</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">valid_std_name</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_std_name</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

                <span class="c1"># 2) optional - if modifiers, should be in table</span>
                <span class="k">if</span> <span class="n">standard_name_modifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">valid_modifier</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.3&quot;</span><span class="p">])</span>
                    <span class="n">valid_modifier</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                        <span class="n">standard_name_modifier</span> <span class="ow">in</span> <span class="n">valid_modifiers</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s1">&#39;Standard name modifier &quot;</span><span class="si">{</span><span class="n">standard_name_modifier</span><span class="si">}</span><span class="s1">&quot; for variable </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> is not a valid modifier &#39;</span>
                        <span class="s2">&quot;according to CF Appendix C&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_modifier</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">standard_name_present</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># IMPLEMENTATION CONFORMANCE 3 RECOMMENDED</span>
            <span class="n">long_or_std_name</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">long_name_present</span> <span class="ow">or</span> <span class="n">standard_name_present</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Attribute long_name or/and standard_name is highly recommended for variable </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">long_or_std_name</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_ancillary_variables">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_ancillary_variables">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_ancillary_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the ancillary_variable attribute for all variables to ensure</span>
<span class="sd">        they are CF compliant.</span>

<span class="sd">        CF §3.4 It is a string attribute whose value is a blank separated list</span>
<span class="sd">        of variable names.  The nature of the relationship between variables</span>
<span class="sd">        associated via ancillary_variables must be determined by other</span>
<span class="sd">        attributes. The variables listed by the ancillary_variables attribute</span>
<span class="sd">        will often have the standard name of the variable which points to them</span>
<span class="sd">        including a modifier (Appendix C, Standard Name Modifiers) to indicate</span>
<span class="sd">        the relationship.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ncvar</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span>
            <span class="n">ancillary_variables</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">ncvar</span><span class="o">.</span><span class="n">name</span>
            <span class="n">valid_ancillary</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.4&quot;</span><span class="p">])</span>
            <span class="n">ancillary_variables</span> <span class="o">=</span> <span class="n">ncvar</span><span class="o">.</span><span class="n">ancillary_variables</span>

            <span class="n">valid_ancillary</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">ancillary_variables</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                <span class="sa">f</span><span class="s2">&quot;ancillary_variables attribute defined by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="s2">&quot;should be string&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Can&#39;t perform the second check if it&#39;s not a string</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ancillary_variables</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_ancillary</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">ancillary_variable</span> <span class="ow">in</span> <span class="n">ancillary_variables</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                <span class="n">valid_ancillary</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="n">ancillary_variable</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ancillary_variable</span><span class="si">}</span><span class="s2"> is not a variable in this dataset&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_ancillary</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_flags">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_flags">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the flag_values, flag_masks and flag_meanings attributes for</span>
<span class="sd">        variables to ensure they are CF compliant.</span>

<span class="sd">        CF §3.5 The attributes flag_values, flag_masks and flag_meanings are</span>
<span class="sd">        intended to make variables that contain flag values self describing.</span>
<span class="sd">        Status codes and Boolean (binary) condition flags may be expressed with</span>
<span class="sd">        different combinations of flag_values and flag_masks attribute</span>
<span class="sd">        definitions.</span>

<span class="sd">        The flag_values and flag_meanings attributes describe a status flag</span>
<span class="sd">        consisting of mutually exclusive coded values.</span>

<span class="sd">        The flag_meanings attribute is a string whose value is a blank</span>
<span class="sd">        separated list of descriptive words or phrases, one for each flag</span>
<span class="sd">        value. Each word or phrase should consist of characters from the</span>
<span class="sd">        alphanumeric set and the following five: &#39;_&#39;, &#39;-&#39;, &#39;.&#39;, &#39;+&#39;, &#39;@&#39;.</span>

<span class="sd">        The flag_masks and flag_meanings attributes describe a number of</span>
<span class="sd">        independent Boolean conditions using bit field notation by setting</span>
<span class="sd">        unique bits in each flag_masks value.</span>

<span class="sd">        The flag_masks, flag_values and flag_meanings attributes, used</span>
<span class="sd">        together, describe a blend of independent Boolean conditions and</span>
<span class="sd">        enumerated status codes. A flagged condition is identified by a bitwise</span>
<span class="sd">        AND of the variable value and each flag_masks value; a result that</span>
<span class="sd">        matches the flag_values value indicates a true condition.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_flag_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">flag_values</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;flag_values&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">flag_masks</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;flag_masks&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">valid_flags_var</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.5&quot;</span><span class="p">])</span>
            <span class="c1"># Check that the variable defines mask or values</span>
            <span class="n">valid_flags_var</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">flag_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">flag_masks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not define either flag_masks or flag_values&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_flags_var</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

            <span class="n">valid_meanings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_meanings</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_meanings</span><span class="p">)</span>

            <span class="c1"># check flag_values</span>
            <span class="k">if</span> <span class="n">flag_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">valid_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_values</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_values</span><span class="p">)</span>

            <span class="c1"># check flag_masks</span>
            <span class="k">if</span> <span class="n">flag_masks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">valid_masks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_masks</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_masks</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">flag_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">flag_masks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vals_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flag_values</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">masks_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flag_masks</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># IMPLEMENTATION CONFORMANCE 3.5 RECOMMENDED 1/1</span>
                <span class="c1"># If shapes aren&#39;t equal, we can&#39;t do proper elementwise</span>
                <span class="c1"># comparison</span>
                <span class="k">if</span> <span class="n">vals_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">masks_arr</span><span class="o">.</span><span class="n">size</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">vals_arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">masks_arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">allv</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">allv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">vals_arr</span> <span class="o">&amp;</span> <span class="n">masks_arr</span> <span class="o">==</span> <span class="n">vals_arr</span><span class="p">)</span>

                <span class="n">allvr</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="n">allv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.5&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">allvr</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="n">allvr</span><span class="o">.</span><span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="sa">f</span><span class="s2">&quot;flag masks and flag values for &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; combined don&#39;t equal flag values&quot;</span><span class="p">,</span>
                    <span class="p">]</span>

                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">allvr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_flag_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks a variable&#39;s flag_values attribute for compliance under CF</span>

<span class="sd">        - flag_values exists as an array</span>
<span class="sd">        - unique elements in flag_values</span>
<span class="sd">        - flag_values si the same dtype as the variable</span>
<span class="sd">        - flag_values is the same length as flag_meanings</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :param str name: Name of variable to check</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="n">flag_values</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;flag_values&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">flag_meanings</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;flag_meanings&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">valid_values</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.5&quot;</span><span class="p">])</span>

        <span class="c1"># IMPLEMENTATION CONFORMANCE 3.5 REQUIRED 2/8</span>
        <span class="n">valid_values</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;flag_meanings&quot;</span><span class="p">),</span>
            <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> must have attribute flag_meanings &quot;</span>
            <span class="s2">&quot;defined when flag_values attribute is present&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># the flag values must be independent, no repeating values</span>
        <span class="n">flag_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">flag_values</span><span class="p">)</span>
        <span class="n">valid_values</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">flag_set</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flag_values</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s flag_values must be independent and can not be repeated&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># IMPLEMENTATION CONFORMANCE 3.5 REQUIRED 1/8</span>
        <span class="c1"># the data type for flag_values should be the same as the variable</span>
        <span class="n">flag_values_type</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">flag_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">flag_values</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">type</span><span class="p">(</span><span class="n">flag_values</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">valid_values</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">flag_values_type</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;flag_values (</span><span class="si">{</span><span class="n">flag_values_type</span><span class="si">}</span><span class="s2">) must be the same data type as </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># IMPLEMENTATION CONFORMANCE 3.5 REQUIRED 4/8</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flag_meanings</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">flag_meanings</span> <span class="o">=</span> <span class="n">flag_meanings</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">valid_values</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">flag_meanings</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flag_values</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s flag_meanings and flag_values should have the same &quot;</span>
                <span class="s2">&quot;number of elements.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">valid_values</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_flag_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check a variable&#39;s flag_masks attribute for compliance under CF</span>

<span class="sd">        - flag_masks exists as an array</span>
<span class="sd">        - flag_masks is the same dtype as the variable</span>
<span class="sd">        - variable&#39;s dtype can support bit-field</span>
<span class="sd">        - flag_masks is the same length as flag_meanings</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :param str name: Variable name</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="n">flag_masks</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">flag_masks</span>
        <span class="n">flag_meanings</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;flag_meanings&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">valid_masks</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.5&quot;</span><span class="p">])</span>

        <span class="n">flag_masks_type</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">flag_masks</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">flag_masks</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">type</span><span class="p">(</span><span class="n">flag_masks</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">valid_masks</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">flag_masks_type</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;flag_masks (</span><span class="si">{</span><span class="n">flag_masks_type</span><span class="si">}</span><span class="s2">) must be the same data type as </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">type_ok</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">valid_masks</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flag_masks</span><span class="p">),</span>
            <span class="sa">f</span><span class="s2">&quot;flag_masks for variable </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> must &quot;</span>
            <span class="s2">&quot;not contain zero as an element&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">valid_masks</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">type_ok</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s data type must be capable of bit-field expression&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flag_meanings</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">flag_meanings</span> <span class="o">=</span> <span class="n">flag_meanings</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">valid_masks</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="c1"># cast to array here as single element arrays are returned as</span>
                <span class="c1"># scalars from netCDF4 Python</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">flag_meanings</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flag_masks</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> flag_meanings and flag_masks should have the same &quot;</span>
                <span class="s2">&quot;number of elements.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">valid_masks</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_flag_meanings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check a variable&#39;s flag_meanings attribute for compliance under CF</span>

<span class="sd">        - flag_meanings exists</span>
<span class="sd">        - flag_meanings is a string</span>
<span class="sd">        - flag_meanings elements are valid strings</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :param str name: Variable name</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">flag_meanings</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;flag_meanings&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">valid_meanings</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;3.5&quot;</span><span class="p">])</span>

        <span class="n">valid_meanings</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">flag_meanings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s flag_meanings attribute is required for flag variables&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">valid_meanings</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">flag_meanings</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s flag_meanings attribute must be a string&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># We can&#39;t perform any additional checks if it&#39;s not a string</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flag_meanings</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">valid_meanings</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

        <span class="n">valid_meanings</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">flag_meanings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s flag_meanings can&#39;t be empty&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># IMPLEMENTATION CONFORMANCE REQUIRED 3.5 3/8</span>
        <span class="n">flag_regx</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[0-9A-Za-z_\-.+@]+$&quot;</span><span class="p">)</span>
        <span class="n">meanings</span> <span class="o">=</span> <span class="n">flag_meanings</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">meaning</span> <span class="ow">in</span> <span class="n">meanings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">flag_regx</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">meaning</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">valid_meanings</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s flag_meanings attribute defined an illegal flag meaning &quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">meaning</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">valid_meanings</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

    <span class="c1">###############################################################################</span>
    <span class="c1"># Chapter 4: Coordinate Types</span>
    <span class="c1">###############################################################################</span>

<div class="viewcode-block" id="CF1_6Check.check_coordinate_types">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_coordinate_types">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_coordinate_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the axis attribute of coordinate variables</span>

<span class="sd">        CF §4 The attribute axis may be attached to a coordinate variable and</span>
<span class="sd">        given one of the values X, Y, Z or T which stand for a longitude,</span>
<span class="sd">        latitude, vertical, or time axis respectively. Alternatively the</span>
<span class="sd">        standard_name attribute may be used for direct identification.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">name</span>
            <span class="c1"># Coordinate compressions should not be checked as a valid</span>
            <span class="c1"># coordinate, which they are not. They are a mechanism to project</span>
            <span class="c1"># an array of indices onto a 2-d grid containing valid coordinates.</span>
            <span class="k">if</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">is_compression_coordinate</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># Even though it&#39;s not allowed in CF 1.6, it is allowed in CF 1.7</span>
            <span class="c1"># and we see people do it, often.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;cf_role&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># §6.1 allows for labels to be referenced as auxiliary coordinate</span>
            <span class="c1"># variables, which should not be checked like the rest of the</span>
            <span class="c1"># coordinates.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;char&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">variable</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">axis</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">valid_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_axis</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_axis</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that the axis attribute is a string and an allowed value, namely</span>
<span class="sd">        one of &#39;T&#39;, &#39;X&#39;, &#39;Y&#39;, or &#39;Z&#39;.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :param str name: Name of the variable</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allowed_axis</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">]</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">axis</span>

        <span class="n">valid_axis</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4&quot;</span><span class="p">])</span>
        <span class="n">axis_is_string</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="nb">str</span><span class="p">),)</span>
        <span class="n">valid_axis</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">axis_is_string</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s axis attribute must be a non-empty string&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># If axis isn&#39;t a string we can&#39;t continue any checks</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axis_is_string</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valid_axis</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

        <span class="n">valid_axis</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">axis</span> <span class="ow">in</span> <span class="n">allowed_axis</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s axis attribute must be T, X, Y, or Z, &quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;currently </span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">valid_axis</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

<div class="viewcode-block" id="CF1_6Check.check_latitude">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_latitude">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check variable(s) that define latitude and are defined correctly according to CF.</span>

<span class="sd">        CF §4.1 Variables representing latitude must always explicitly include</span>
<span class="sd">        the units attribute; there is no default value.  The recommended unit</span>
<span class="sd">        of latitude is degrees_north. Also acceptable are degree_north,</span>
<span class="sd">        degree_N, degrees_N, degreeN, and degreesN.</span>

<span class="sd">        Optionally, the latitude type may be indicated additionally by</span>
<span class="sd">        providing the standard_name attribute with the value latitude, and/or</span>
<span class="sd">        the axis attribute with the value Y.</span>

<span class="sd">        - Four checks per latitude variable</span>
<span class="sd">        - (H) latitude has units attribute</span>
<span class="sd">        - (M) latitude has an allowed units attribute</span>
<span class="sd">        - (L) latitude uses degrees_north (if not in rotated pole)</span>
<span class="sd">        - (M) latitude defines either standard_name or axis</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">allowed_lat_units</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;degrees_north&quot;</span><span class="p">,</span>
            <span class="s2">&quot;degree_north&quot;</span><span class="p">,</span>
            <span class="s2">&quot;degree_n&quot;</span><span class="p">,</span>
            <span class="s2">&quot;degrees_n&quot;</span><span class="p">,</span>
            <span class="s2">&quot;degreen&quot;</span><span class="p">,</span>
            <span class="s2">&quot;degreesn&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Determine the grid mappings in this dataset</span>
        <span class="n">grid_mapping</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">grid_mapping_variables</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_grid_mapping_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">grid_mapping_variables</span><span class="p">:</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">grid_mapping_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;grid_mapping_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">grid_mapping_name</span><span class="p">:</span>
                <span class="n">grid_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid_mapping_name</span><span class="p">)</span>

        <span class="n">latitude_variables</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_latitude_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">latitude</span> <span class="ow">in</span> <span class="n">latitude_variables</span><span class="p">:</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">latitude</span><span class="p">]</span>
            <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">units_is_string</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># Check that latitude defines units</span>
            <span class="n">valid_latitude</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.1&quot;</span><span class="p">])</span>
            <span class="n">valid_latitude</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;latitude variable &#39;</span><span class="si">{</span><span class="n">latitude</span><span class="si">}</span><span class="s2">&#39; must define units&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_latitude</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

            <span class="c1"># Check that latitude uses allowed units</span>
            <span class="n">allowed_units</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.1&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">standard_name</span> <span class="o">==</span> <span class="s2">&quot;grid_latitude&quot;</span><span class="p">:</span>
                <span class="n">e_n_units</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">VALID_LAT_UNITS</span> <span class="o">|</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">VALID_LON_UNITS</span>
                <span class="c1"># check that the units aren&#39;t in east and north degrees units,</span>
                <span class="c1"># but are convertible to angular units</span>
                <span class="n">allowed_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e_n_units</span> <span class="ow">and</span> <span class="n">Unit</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">==</span> <span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;degree&quot;</span><span class="p">),</span>
                    <span class="sa">f</span><span class="s2">&quot;Grid latitude variable &#39;</span><span class="si">{</span><span class="n">latitude</span><span class="si">}</span><span class="s2">&#39; should use degree equivalent units without east or north components. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Current units are </span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">allowed_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="n">units_is_string</span> <span class="ow">and</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">allowed_lat_units</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;latitude variable &#39;</span><span class="si">{</span><span class="n">latitude</span><span class="si">}</span><span class="s2">&#39; should define valid units for latitude&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">allowed_units</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

            <span class="c1"># Check that latitude uses degrees_north</span>
            <span class="k">if</span> <span class="n">standard_name</span> <span class="o">==</span> <span class="s2">&quot;latitude&quot;</span> <span class="ow">and</span> <span class="n">units</span> <span class="o">!=</span> <span class="s2">&quot;degrees_north&quot;</span><span class="p">:</span>
                <span class="c1"># This is only a recommendation and we won&#39;t penalize but we</span>
                <span class="c1"># will include a recommended action.</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;CF recommends latitude variable &#39;</span><span class="si">{</span><span class="n">latitude</span><span class="si">}</span><span class="s2">&#39; to use units degrees_north&quot;</span>
                    <span class="s2">&quot;&quot;</span>
                <span class="p">)</span>
                <span class="n">recommended_units</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
                    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.1&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">msg</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recommended_units</span><span class="p">)</span>

            <span class="n">y_variables</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
            <span class="c1"># Check that latitude defines either standard_name or axis</span>
            <span class="n">definition</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.1&quot;</span><span class="p">])</span>
            <span class="n">definition</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">standard_name</span> <span class="o">==</span> <span class="s2">&quot;latitude&quot;</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span> <span class="ow">or</span> <span class="n">y_variables</span> <span class="o">!=</span> <span class="p">[],</span>
                <span class="sa">f</span><span class="s2">&quot;latitude variable &#39;</span><span class="si">{</span><span class="n">latitude</span><span class="si">}</span><span class="s2">&#39; should define standard_name=&#39;latitude&#39; or axis=&#39;Y&#39;&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_longitude">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_longitude">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check variable(s) that define longitude and are defined correctly according to CF.</span>

<span class="sd">        CF §4.2 Variables representing longitude must always explicitly include</span>
<span class="sd">        the units attribute; there is no default value.  The recommended unit</span>
<span class="sd">        of longitude is degrees_east. Also acceptable are degree_east,</span>
<span class="sd">        degree_E, degrees_E, degreeE, and degreesE.</span>

<span class="sd">        Optionally, the longitude type may be indicated additionally by</span>
<span class="sd">        providing the standard_name attribute with the value longitude, and/or</span>
<span class="sd">        the axis attribute with the value X.</span>

<span class="sd">        - Four checks per longitude variable</span>
<span class="sd">        - (H) longitude has units attribute</span>
<span class="sd">        - (M) longitude has an allowed units attribute</span>
<span class="sd">        - (L) longitude uses degrees_east (if not in rotated pole)</span>
<span class="sd">        - (M) longitude defines either standard_name or axis</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO we already have a check_latitude... I&#39;m sure we can make DRYer</span>

        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">allowed_lon_units</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;degrees_east&quot;</span><span class="p">,</span>
            <span class="s2">&quot;degree_east&quot;</span><span class="p">,</span>
            <span class="s2">&quot;degree_e&quot;</span><span class="p">,</span>
            <span class="s2">&quot;degrees_e&quot;</span><span class="p">,</span>
            <span class="s2">&quot;degreee&quot;</span><span class="p">,</span>
            <span class="s2">&quot;degreese&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Determine the grid mappings in this dataset</span>
        <span class="n">grid_mapping</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">grid_mapping_variables</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_grid_mapping_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">grid_mapping_variables</span><span class="p">:</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">grid_mapping_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;grid_mapping_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">grid_mapping_name</span><span class="p">:</span>
                <span class="n">grid_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid_mapping_name</span><span class="p">)</span>

        <span class="n">longitude_variables</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_longitude_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">longitude</span> <span class="ow">in</span> <span class="n">longitude_variables</span><span class="p">:</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">longitude</span><span class="p">]</span>
            <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">units_is_string</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># NOTE see docstring--should below be 4.1 or 4.2?</span>
            <span class="c1"># Check that longitude defines units</span>
            <span class="n">valid_longitude</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.2&quot;</span><span class="p">])</span>
            <span class="n">valid_longitude</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;longitude variable &#39;</span><span class="si">{</span><span class="n">longitude</span><span class="si">}</span><span class="s2">&#39; must define units&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_longitude</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

            <span class="c1"># Check that longitude uses allowed units</span>
            <span class="n">allowed_units</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.2&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">standard_name</span> <span class="o">==</span> <span class="s2">&quot;grid_longitude&quot;</span><span class="p">:</span>
                <span class="n">e_n_units</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">VALID_LAT_UNITS</span> <span class="o">|</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">VALID_LON_UNITS</span>
                <span class="c1"># check that the units aren&#39;t in east and north degrees units,</span>
                <span class="c1"># but are convertible to angular units</span>
                <span class="n">allowed_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e_n_units</span> <span class="ow">and</span> <span class="n">Unit</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">==</span> <span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;degree&quot;</span><span class="p">),</span>
                    <span class="sa">f</span><span class="s2">&quot;Grid longitude variable &#39;</span><span class="si">{</span><span class="n">longitude</span><span class="si">}</span><span class="s2">&#39; should use degree equivalent units without east or north components. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Current units are </span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">allowed_units</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="n">units_is_string</span> <span class="ow">and</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">allowed_lon_units</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;longitude variable &#39;</span><span class="si">{</span><span class="n">longitude</span><span class="si">}</span><span class="s2">&#39; should define valid units for longitude&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">allowed_units</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

            <span class="c1"># Check that longitude uses degrees_east</span>
            <span class="k">if</span> <span class="n">standard_name</span> <span class="o">==</span> <span class="s2">&quot;longitude&quot;</span> <span class="ow">and</span> <span class="n">units</span> <span class="o">!=</span> <span class="s2">&quot;degrees_east&quot;</span><span class="p">:</span>
                <span class="c1"># This is only a recommendation and we won&#39;t penalize but we</span>
                <span class="c1"># will include a recommended action.</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;CF recommends longitude variable &#39;</span><span class="si">{</span><span class="n">longitude</span><span class="si">}</span><span class="s2">&#39; to use units degrees_east&quot;</span>
                    <span class="s2">&quot;&quot;</span>
                <span class="p">)</span>
                <span class="n">recommended_units</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
                    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.2&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">msg</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recommended_units</span><span class="p">)</span>

            <span class="n">x_variables</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
            <span class="c1"># Check that longitude defines either standard_name or axis</span>
            <span class="n">definition</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.2&quot;</span><span class="p">])</span>
            <span class="n">definition</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">standard_name</span> <span class="o">==</span> <span class="s2">&quot;longitude&quot;</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span> <span class="ow">or</span> <span class="n">x_variables</span> <span class="o">!=</span> <span class="p">[],</span>
                <span class="sa">f</span><span class="s2">&quot;longitude variable &#39;</span><span class="si">{</span><span class="n">longitude</span><span class="si">}</span><span class="s2">&#39; should define standard_name=&#39;longitude&#39; or axis=&#39;X&#39;&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_dimensional_vertical_coordinate">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_dimensional_vertical_coordinate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_dimensional_vertical_coordinate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ds</span><span class="p">,</span>
        <span class="n">dimless_vertical_coordinates</span><span class="o">=</span><span class="n">dimless_vertical_coordinates_1_6</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check units for variables defining vertical position are valid under</span>
<span class="sd">        CF.</span>

<span class="sd">        CF §4.3.1 The units attribute for dimensional coordinates will be a string</span>
<span class="sd">        formatted as per the udunits.dat file.</span>

<span class="sd">        The acceptable units for vertical (depth or height) coordinate variables</span>
<span class="sd">        are:</span>
<span class="sd">        - units of pressure as listed in the file udunits.dat. For vertical axes</span>
<span class="sd">          the most commonly used of these include include bar, millibar,</span>
<span class="sd">          decibar, atmosphere (atm), pascal (Pa), and hPa.</span>
<span class="sd">        - units of length as listed in the file udunits.dat. For vertical axes</span>
<span class="sd">          the most commonly used of these include meter (metre, m), and</span>
<span class="sd">          kilometer (km).</span>
<span class="sd">        - other units listed in the file udunits.dat that may under certain</span>
<span class="sd">          circumstances reference vertical position such as units of density or</span>
<span class="sd">          temperature.</span>

<span class="sd">        Plural forms are also acceptable.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">z_variables</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_z_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="c1"># dimless_standard_names = [name for name, regx in dimless_vertical_coordinates]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">z_variables</span><span class="p">:</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">positive</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;positive&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># Skip the variable if it&#39;s dimensionless</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;formula_terms&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">standard_name</span> <span class="ow">in</span> <span class="n">dimless_vertical_coordinates</span>
            <span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">valid_vertical_coord</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.3&quot;</span><span class="p">])</span>
            <span class="n">valid_vertical_coord</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">units</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;§4.3.1 </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s units must be defined for vertical coordinates, &quot;</span>
                <span class="s2">&quot;there is no default&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">units_convertible</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
                <span class="n">valid_vertical_coord</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="n">positive</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">),</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: vertical coordinates not defining pressure must include &quot;</span>
                    <span class="s2">&quot;a positive attribute that is either &#39;up&#39; or &#39;down&#39;&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># _check_valid_standard_units, part of the Chapter 3 checks,</span>
            <span class="c1"># already verifies that this coordinate has valid units</span>

            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_vertical_coord</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_dimensionless_vertical_coordinate_1_6</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ds</span><span class="p">,</span>
        <span class="n">vname</span><span class="p">,</span>
        <span class="n">deprecated_units</span><span class="p">,</span>
        <span class="n">ret_val</span><span class="p">,</span>
        <span class="n">dim_vert_coords_dict</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that a dimensionless vertical coordinate variable is valid under</span>
<span class="sd">        CF-1.6.</span>

<span class="sd">        :param netCDF4.Dataset ds: open netCDF4 dataset</span>
<span class="sd">        :param str name: variable name</span>
<span class="sd">        :param list ret_val: array to append Results to</span>
<span class="sd">        :rtype None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">vname</span><span class="p">]</span>
        <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">formula_terms</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;formula_terms&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Skip the variable if it&#39;s dimensional</span>
        <span class="k">if</span> <span class="n">formula_terms</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">standard_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dim_vert_coords_dict</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">is_not_deprecated</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.3&quot;</span><span class="p">])</span>

        <span class="n">is_not_deprecated</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">deprecated_units</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;§4.3.2: units are deprecated by CF in variable </span><span class="si">{</span><span class="n">vname</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># check the vertical coordinates</span>
        <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">is_not_deprecated</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>
        <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_formula_terms</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">vname</span><span class="p">,</span> <span class="n">dim_vert_coords_dict</span><span class="p">))</span>

<div class="viewcode-block" id="CF1_6Check.check_dimensionless_vertical_coordinates">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_dimensionless_vertical_coordinates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_dimensionless_vertical_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the validity of dimensionless coordinates under CF</span>

<span class="sd">        CF §4.3.2 The units attribute is not required for dimensionless</span>
<span class="sd">        coordinates.</span>

<span class="sd">        The standard_name attribute associates a coordinate with its definition</span>
<span class="sd">        from Appendix D, Dimensionless Vertical Coordinates. The definition</span>
<span class="sd">        provides a mapping between the dimensionless coordinate values and</span>
<span class="sd">        dimensional values that can positively and uniquely indicate the</span>
<span class="sd">        location of the data.</span>

<span class="sd">        A new attribute, formula_terms, is used to associate terms in the</span>
<span class="sd">        definitions with variables in a netCDF file.  To maintain backwards</span>
<span class="sd">        compatibility with COARDS the use of these attributes is not required,</span>
<span class="sd">        but is strongly recommended.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">deprecated_units</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma_level&quot;</span><span class="p">]</span>

        <span class="n">ret_val</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_dimensionless_vertical_coordinates</span><span class="p">(</span>
                <span class="n">ds</span><span class="p">,</span>
                <span class="n">deprecated_units</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_dimensionless_vertical_coordinate_1_6</span><span class="p">,</span>
                <span class="n">dimless_vertical_coordinates_1_6</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_time_coordinate">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_time_coordinate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_time_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check variables defining time are valid under CF</span>

<span class="sd">        CF §4.4 Variables representing time must always explicitly include the</span>
<span class="sd">        units attribute; there is no default value.</span>

<span class="sd">        The units attribute takes a string value formatted as per the</span>
<span class="sd">        recommendations in the Udunits package.</span>

<span class="sd">        The acceptable units for time are listed in the udunits.dat file. The</span>
<span class="sd">        most commonly used of these strings (and their abbreviations) includes</span>
<span class="sd">        day (d), hour (hr, h), minute (min) and second (sec, s). Plural forms</span>
<span class="sd">        are also acceptable. The reference time string (appearing after the</span>
<span class="sd">        identifier since) may include date alone; date and time; or date, time,</span>
<span class="sd">        and time zone. The reference time is required. A reference time in year</span>
<span class="sd">        0 has a special meaning (see Section 7.4, &quot;Climatological Statistics&quot;).</span>

<span class="sd">        Recommend that the unit year be used with caution. It is not a calendar</span>
<span class="sd">        year.  For similar reasons the unit month should also be used with</span>
<span class="sd">        caution.</span>

<span class="sd">        A time coordinate is identifiable from its units string alone.</span>
<span class="sd">        Optionally, the time coordinate may be indicated additionally by</span>
<span class="sd">        providing the standard_name attribute with an appropriate value, and/or</span>
<span class="sd">        the axis attribute with the value T.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_time_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># Has units</span>
            <span class="n">has_units</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_units</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.4&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not have units&quot;</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="c1"># Correct and identifiable units</span>
            <span class="c1"># TODO: year zero climatological time warning</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.4&quot;</span><span class="p">])</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">correct_units</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">units_temporal</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
            <span class="n">reasoning</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">correct_units</span><span class="p">:</span>
                <span class="n">reasoning</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not have correct time units&quot;</span><span class="p">]</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                    <span class="n">correct_units</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.4&quot;</span><span class="p">],</span>
                    <span class="n">reasoning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="c1"># IMPLEMENTATION CONFORMANCE 4.4 RECOMMENDED 1/2</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;climatology&quot;</span><span class="p">):</span>
                <span class="n">year_match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\w+ since (?P&lt;year&gt;\d{1,4})&quot;</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
                <span class="c1"># year should always exist at this point if it&#39;s been parsed as</span>
                <span class="c1"># valid date</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Time coordinate variable </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s &quot;</span>
                        <span class="s2">&quot;use of year 0 for climatological time is &quot;</span>
                        <span class="s2">&quot;deprecated&quot;</span>
                    <span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                        <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                        <span class="kc">False</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.4&quot;</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">message</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="c1"># IMPLEMENTATION CONFORMANCE 4.4 RECOMMENDED 2/2</span>
            <span class="c1"># catch non-recommended months or years time interval</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">unit</span> <span class="ow">in</span> <span class="n">variable</span><span class="o">.</span><span class="n">units</span> <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;months&quot;</span><span class="p">,</span> <span class="s2">&quot;years&quot;</span><span class="p">)):</span>
                <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Using relative time interval of months or years is not recommended for coordinate variable </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.4&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">message</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_calendar">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_calendar">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_calendar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the calendar attribute for variables defining time and ensure it</span>
<span class="sd">        is a valid calendar prescribed by CF.</span>

<span class="sd">        CF §4.4.1 In order to calculate a new date and time given a base date, base</span>
<span class="sd">        time and a time increment one must know what calendar to use.</span>

<span class="sd">        The values currently defined for calendar are:</span>
<span class="sd">        - gregorian or standard</span>
<span class="sd">        - proleptic_gregorian</span>
<span class="sd">        - noleap or 365_day</span>
<span class="sd">        - all_leap or 366_day</span>
<span class="sd">        - 360_day</span>
<span class="sd">        - julian</span>
<span class="sd">        - none</span>

<span class="sd">        The calendar attribute may be set to none in climate experiments that</span>
<span class="sd">        simulate a fixed time of year.</span>
<span class="sd">        The time of year is indicated by the date in the reference time of the</span>
<span class="sd">        units attribute.</span>

<span class="sd">        If none of the calendars defined above applies, a non-standard calendar</span>
<span class="sd">        can be defined. The lengths of each month are explicitly defined with</span>
<span class="sd">        the month_lengths attribute of the time axis.</span>

<span class="sd">        If leap years are included, then two other attributes of the time axis</span>
<span class="sd">        should also be defined:</span>

<span class="sd">        leap_year, leap_month</span>

<span class="sd">        The calendar attribute is not required when a non-standard calendar is</span>
<span class="sd">        being used. It is sufficient to define the calendar using the</span>
<span class="sd">        month_lengths attribute, along with leap_year, and leap_month as</span>
<span class="sd">        appropriate. However, the calendar attribute is allowed to take</span>
<span class="sd">        non-standard values and in that case defining the non-standard calendar</span>
<span class="sd">        using the appropriate attributes is required.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">standard_calendars</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;gregorian&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard&quot;</span><span class="p">,</span>
            <span class="s2">&quot;proleptic_gregorian&quot;</span><span class="p">,</span>
            <span class="s2">&quot;noleap&quot;</span><span class="p">,</span>
            <span class="s2">&quot;365_day&quot;</span><span class="p">,</span>
            <span class="s2">&quot;all_leap&quot;</span><span class="p">,</span>
            <span class="s2">&quot;366_day&quot;</span><span class="p">,</span>
            <span class="s2">&quot;360_day&quot;</span><span class="p">,</span>
            <span class="s2">&quot;julian&quot;</span><span class="p">,</span>
            <span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">check_standard_calendar_no_cross</span><span class="p">(</span><span class="n">time_var</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Check that the time variable does not cross the date</span>
<span class="sd">            1582-10-15 when standard or gregorian calendars are used</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Short-circuit if using months/years.</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">unit</span> <span class="ow">in</span> <span class="n">time_var</span><span class="o">.</span><span class="n">units</span> <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;months&quot;</span><span class="p">,</span> <span class="s2">&quot;years&quot;</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.4&quot;</span><span class="p">],</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;Miscellaneous failure when attempting to calculate crossover, possible malformed date&quot;</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">)</span>
            <span class="n">time_values</span> <span class="o">=</span> <span class="n">time_var</span><span class="p">[:]</span>

            <span class="c1"># IMPLEMENTATION CONFORMANCE 4.4.1 RECOMMENDED 2/2</span>
            <span class="c1"># Only get non-nan/FillValue times, as these are the only things</span>
            <span class="c1"># that make sense for conversion.  Furthermore, non-null checks</span>
            <span class="c1"># should be made for time coordinate variables anyways, so errors</span>
            <span class="c1"># should be caught where implemented there</span>
            <span class="n">crossover_date</span> <span class="o">=</span> <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
            <span class="n">crossover_date_value</span> <span class="o">=</span> <span class="n">cftime</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span>
                <span class="n">crossover_date</span><span class="p">,</span>
                <span class="n">time_var</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                <span class="n">calendar</span><span class="o">=</span><span class="n">time_var</span><span class="o">.</span><span class="n">calendar</span><span class="p">,</span>
                <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># has_year_zero set to true in order to just check crossover,</span>
            <span class="c1"># actual year less than or equal to zero check handled elsewhere</span>
            <span class="c1"># when standard/Gregorian, or Julian calendars used.</span>

            <span class="c1"># Comparing cftime objects is awfully slow. Converting them toordinal makes this a bit faster.</span>
            <span class="c1"># https://github.com/ioos/compliance-checker/issues/1211</span>
            <span class="n">crossover_1582</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">time_values</span> <span class="o">&lt;</span> <span class="n">crossover_date_value</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span>
                <span class="n">time_values</span> <span class="o">&gt;=</span> <span class="n">crossover_date_value</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">crossover_1582</span><span class="p">:</span>
                <span class="n">reasoning</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">time_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has standard or Gregorian &quot;</span>
                    <span class="s2">&quot;calendar and does not cross 1582-10-15T00:00Z&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reasoning</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">time_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has time values &quot;</span>
                    <span class="s2">&quot;prior to 1582-10-15T00:00Z and utilizes &quot;</span>
                    <span class="s2">&quot;the standard or Gregorian calendar&quot;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">BaseCheck</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
                <span class="ow">not</span> <span class="n">crossover_1582</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.4&quot;</span><span class="p">],</span>
                <span class="p">[</span><span class="n">reasoning</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># if has a calendar, check that it is within the valid values</span>
        <span class="c1"># otherwise no calendar is valid</span>

        <span class="c1"># this will only fetch variables with time units defined</span>
        <span class="k">for</span> <span class="n">time_var_name</span> <span class="ow">in</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_time_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">time_var_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">util</span><span class="o">.</span><span class="n">find_coord_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">)}:</span>
                <span class="k">continue</span>
            <span class="n">time_var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">time_var_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">time_var</span><span class="p">,</span> <span class="s2">&quot;calendar&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">time_var</span><span class="o">.</span><span class="n">calendar</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;gregorian&quot;</span><span class="p">:</span>
                <span class="n">reasoning</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;For time variable </span><span class="si">{</span><span class="n">time_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, when using &quot;</span>
                    <span class="s2">&quot;the standard Gregorian calendar, the value &quot;</span>
                    <span class="s1">&#39;&quot;standard&quot; is preferred over &quot;gregorian&quot; for &#39;</span>
                    <span class="s2">&quot;the calendar attribute&quot;</span>
                <span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.4.1&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">reasoning</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="c1"># check here and in the below case that time does not cross</span>
                <span class="c1"># thee date 1582-10-15 as requested by CF conformance</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">check_standard_calendar_no_cross</span><span class="p">(</span><span class="n">time_var</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">time_var</span><span class="o">.</span><span class="n">calendar</span> <span class="o">==</span> <span class="s2">&quot;standard&quot;</span><span class="p">:</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">check_standard_calendar_no_cross</span><span class="p">(</span><span class="n">time_var</span><span class="p">))</span>
            <span class="c1"># if a nonstandard calendar, then leap_years and leap_months must</span>
            <span class="c1"># must be present</span>
            <span class="k">if</span> <span class="n">time_var</span><span class="o">.</span><span class="n">calendar</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">standard_calendars</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_leap_time</span><span class="p">(</span><span class="n">time_var</span><span class="p">)</span>
            <span class="c1"># passes if the calendar is valid, otherwise notify of invalid</span>
            <span class="c1"># calendar</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.4.1&quot;</span><span class="p">])</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_leap_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_variable</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to handle checking custom calendar leap time specifications</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">leap_time</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;4.4&quot;</span><span class="p">])</span>
        <span class="n">leap_time</span><span class="o">.</span><span class="n">out_of</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># IMPLEMENTATION CONFORMANCE 4.4.1 REQUIRED 2, 3 / 5</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">time_variable</span><span class="p">,</span> <span class="s2">&quot;month_lengths&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">time_variable</span><span class="o">.</span><span class="n">month_lengths</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">time_variable</span><span class="o">.</span><span class="n">month_lengths</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">time_variable</span><span class="o">.</span><span class="n">month_lengths</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">12</span>
        <span class="p">):</span>
            <span class="n">leap_time</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;For nonstandard calendar on variable </span><span class="si">{</span><span class="n">time_variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;attribute month_lengths must be supplied as a 12-element &quot;</span>
                <span class="s2">&quot;integer array&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">leap_time</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>
        <span class="c1"># If leap years are included, then attributes leap_month and</span>
        <span class="c1"># leap_year must be included.</span>
        <span class="n">has_leap_year</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">time_variable</span><span class="p">,</span> <span class="s2">&quot;leap_year&quot;</span><span class="p">)</span>
        <span class="c1"># IMPLEMENTATION CONFORMANCE 4.4.1 REQUIRED 4,5/5</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">time_variable</span><span class="p">,</span> <span class="s2">&quot;leap_month&quot;</span><span class="p">):</span>
            <span class="n">leap_time</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">time_variable</span><span class="o">.</span><span class="n">leap_month</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">time_variable</span><span class="o">.</span><span class="n">leap_month</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">time_variable</span><span class="o">.</span><span class="n">leap_month</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">time_variable</span><span class="o">.</span><span class="n">leap_month</span> <span class="o">&lt;=</span> <span class="mi">12</span>
                <span class="p">),</span>
                <span class="s2">&quot;When attribute leap_month is supplied for variable &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, the value must be a scalar integer &quot;</span>
                <span class="s2">&quot;between 1 and 12&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># IMPLEMENTATION CONFORMANCE 4.4.1 RECOMMENDED 1/2</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_leap_year</span><span class="p">:</span>
                <span class="n">leap_time</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">fail_message</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;For time variable </span><span class="si">{</span><span class="n">time_variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="s2">&quot;attribute leap_year must be present if &quot;</span>
                    <span class="s2">&quot;leap_month attribute is defined&quot;</span>
                <span class="p">)</span>
                <span class="n">leap_time</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fail_message</span><span class="p">)</span>

        <span class="c1"># IMPLEMENTATION CONFORMANCE 4.4.1 REQUIRED 5/5</span>
        <span class="k">if</span> <span class="n">has_leap_year</span><span class="p">:</span>
            <span class="n">leap_time</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">time_variable</span><span class="o">.</span><span class="n">leap_year</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">time_variable</span><span class="o">.</span><span class="n">leap_year</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">),</span>
                <span class="s2">&quot;When attribute leap_year is supplied for variable &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, the value must be a scalar &quot;</span>
                <span class="s2">&quot;integer&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">leap_time</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span>

    <span class="c1">###############################################################################</span>
    <span class="c1"># Chapter 5: Coordinate Systems</span>
    <span class="c1">###############################################################################</span>

<div class="viewcode-block" id="CF1_6Check.check_aux_coordinates">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_aux_coordinates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_aux_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Chapter 5 paragraph 3</span>

<span class="sd">        The dimensions of an auxiliary coordinate variable must be a subset of</span>
<span class="sd">        the dimensions of the variable with which the coordinate is associated,</span>
<span class="sd">        with two exceptions. First, string-valued coordinates (Section 6.1,</span>
<span class="sd">        &quot;Labels&quot;) have a dimension for maximum string length. Second, in the</span>
<span class="sd">        ragged array representations of data (Chapter 9, Discrete Sampling</span>
<span class="sd">        Geometries), special methods are needed to connect the data and</span>
<span class="sd">        coordinates.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># for contiguous ragged array/indexed ragged array representations,</span>
        <span class="c1"># coordinates are not required to adhere to the same principles;</span>
        <span class="c1"># these representaitions can be identified by two attributes:</span>

        <span class="c1"># required for contiguous</span>
        <span class="n">count_vars</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span>
            <span class="n">sample_dimension</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># required for indexed</span>
        <span class="n">index_vars</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span>
            <span class="n">instance_dimension</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># if these attributes exist, we don&#39;t need to test</span>
        <span class="c1"># the coordinates</span>
        <span class="k">if</span> <span class="n">count_vars</span> <span class="ow">or</span> <span class="n">index_vars</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret_val</span>

        <span class="n">geophysical_variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_geophysical_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">geophysical_variables</span><span class="p">:</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># We use a set so we can assert</span>
            <span class="n">dim_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>
            <span class="c1"># No auxiliary coordinates, no check</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">coordinates</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">valid_aux_coords</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;5&quot;</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">aux_coord</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                <span class="n">valid_aux_coords</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="n">aux_coord</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s auxiliary coordinate specified by the coordinates attribute, </span><span class="si">{</span><span class="n">aux_coord</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="s2">&quot;is not a variable in this dataset&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">aux_coord</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># TODO CONFORMANCE: Partial implementation of labels</span>
                <span class="c1"># §6.1 Allows for &quot;labels&quot; to be referenced as coordinates</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">hasattr</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">aux_coord</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;char&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">aux_coord</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span>
                <span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">aux_coord</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">aux_coord_dims</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">aux_coord</span><span class="p">]</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>
                <span class="n">valid_aux_coords</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="n">aux_coord_dims</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">dim_set</span><span class="p">),</span>
                    <span class="s2">&quot;dimensions for auxiliary coordinate variable </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">) &quot;</span>
                    <span class="s2">&quot;are not a subset of dimensions for variable </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">aux_coord</span><span class="p">,</span>
                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aux_coord_dims</span><span class="p">),</span>
                        <span class="n">name</span><span class="p">,</span>
                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_set</span><span class="p">),</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_aux_coords</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="c1"># IMPLEMENTATION Section 5 Coordinate Systems and Domain</span>
<div class="viewcode-block" id="CF1_6Check.check_coordinates_attribute_format">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_coordinates_attribute_format">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_coordinates_attribute_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that the `coordinates` attribute is a space-separated list of valid variable names,</span>
<span class="sd">        and all listed variables exist in the dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">geophysical_variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_geophysical_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">geophysical_variables</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
            <span class="n">coord_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">coord_attr</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># No coordinates attribute, nothing to check</span>

            <span class="n">check_coords_attrs_format</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span>
                <span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;5&quot;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="c1"># Check that it is a proper string</span>
            <span class="n">check_coords_attrs_format</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">coord_attr</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                <span class="sa">f</span><span class="s2">&quot;The &#39;coordinates&#39; attribute of variable &#39;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&#39; must be a string.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Check for unexpected characters (e.g., commas or brackets)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coord_attr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">has_invalid_chars</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="n">char</span> <span class="ow">in</span> <span class="n">coord_attr</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;)&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">check_coords_attrs_format</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="ow">not</span> <span class="n">has_invalid_chars</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;The &#39;coordinates&#39; attribute of variable &#39;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&#39; contains invalid characters: </span><span class="si">{</span><span class="n">coord_attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Check that each token is a valid variable name</span>
                <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">coord_attr</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                    <span class="n">check_coords_attrs_format</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                        <span class="n">token</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;The &#39;coordinates&#39; attribute of variable &#39;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&#39; references non-existent variable &#39;</span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">check_coords_attrs_format</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="c1"># IMPLEMENTATION Section 5.1 Independent Latitude, Longitude, Vertical, and Time Axes,</span>
<div class="viewcode-block" id="CF1_6Check.check_spatiotemporal_dims_have_coordinate_vars">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_spatiotemporal_dims_have_coordinate_vars">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_spatiotemporal_dims_have_coordinate_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that spatial/temporal dimensions (time, lat, lon, height, ...)</span>
<span class="sd">        used in geophysical variables have proper coordinate variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># CF-recognized standard names for coordinate axes</span>
        <span class="n">expected_standard_names</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="s2">&quot;height&quot;</span><span class="p">,</span>
            <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="s2">&quot;depth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;altitude&quot;</span><span class="p">:</span> <span class="s2">&quot;altitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="s2">&quot;air_pressure&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">geophysical_variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_geophysical_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">geophysical_variables</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
            <span class="n">check_spatiotemporal_dims_coords</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span>
                <span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;5.1&quot;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">expected_standard_names</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                        <span class="n">check_spatiotemporal_dims_coords</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                            <span class="kc">False</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">&quot;Dimension &#39;</span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&#39; in variable &#39;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&#39; is expected to be a coordinate axis &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;but no variable with that name exists.&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="n">coord_var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
                    <span class="n">std_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">coord_var</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                    <span class="n">check_spatiotemporal_dims_coords</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                        <span class="n">std_name</span> <span class="o">==</span> <span class="n">expected_standard_names</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s2">&quot;Coordinate variable &#39;</span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&#39; should have standard_name=&#39;</span><span class="si">{</span><span class="n">expected_standard_names</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;found: &#39;</span><span class="si">{</span><span class="n">std_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">check_spatiotemporal_dims_coords</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="c1"># IMPLEMENTATION Section 2.5.1 Coordinate Systems and Domain</span>
<div class="viewcode-block" id="CF1_6Check.check_invalid_coordinate_attr">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_invalid_coordinate_attr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_invalid_coordinate_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that a coordinate variable must not have the _FillValue or missing_value attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">coord_var_name</span> <span class="ow">in</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_coordinate_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
            <span class="n">coord_var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">coord_var_name</span><span class="p">]</span>
            <span class="n">valid_coords_attr</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;2.5.1&quot;</span><span class="p">])</span>

            <span class="n">valid_coords_attr</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="s2">&quot;_FillValue&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coord_var</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">(),</span>
                <span class="sa">f</span><span class="s2">&quot;The coordinate variable &#39;</span><span class="si">{</span><span class="n">coord_var_name</span><span class="si">}</span><span class="s2">&#39; must not have the _FillValue attribute.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">valid_coords_attr</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="s2">&quot;missing_value&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coord_var</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">(),</span>
                <span class="sa">f</span><span class="s2">&quot;The coordinate variable &#39;</span><span class="si">{</span><span class="n">coord_var_name</span><span class="si">}</span><span class="s2">&#39; must not have the missing_value attribute.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_coords_attr</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_duplicate_axis">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_duplicate_axis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_duplicate_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that no variable contains two coordinates defining the same</span>

<span class="sd">        Chapter 5 paragraph 6</span>

<span class="sd">        If an axis attribute is attached to an auxiliary coordinate variable,</span>
<span class="sd">        it can be used by applications in the same way the `axis` attribute</span>
<span class="sd">        attached to a coordinate variable is used. However, it is not</span>
<span class="sd">        permissible for a [geophysical variable] to have both a coordinate</span>
<span class="sd">        variable and an auxiliary coordinate variable, or more than one of</span>
<span class="sd">        either type of variable, having an `axis` attribute with any given</span>
<span class="sd">        value e.g. there must be no more than one axis attribute for X for any</span>
<span class="sd">        [geophysical variable].</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">geophysical_variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_geophysical_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">geophysical_variables</span><span class="p">:</span>
            <span class="n">no_duplicates</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;5&quot;</span><span class="p">])</span>
            <span class="n">axis_map</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_axis_map</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="c1"># For every coordinate associated with this variable, keep track of</span>
            <span class="c1"># which coordinates define an axis and assert that there are no</span>
            <span class="c1"># duplicate axis attributes defined in the set of associated</span>
            <span class="c1"># coordinates. axis_map includes coordinates that don&#39;t actually have</span>
            <span class="c1"># an axis attribute, so we need to ignore those here.</span>
            <span class="k">for</span> <span class="n">axis</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">axis_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coords</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="s2">&quot;axis&quot;</span><span class="p">)]</span>
                <span class="n">no_duplicates</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; has duplicate axis </span><span class="si">{}</span><span class="s2"> defined by [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">name</span><span class="p">,</span>
                        <span class="n">axis</span><span class="p">,</span>
                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">coords</span><span class="p">)),</span>
                    <span class="p">),</span>
                <span class="p">)</span>

            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">no_duplicates</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_multi_dimensional_coords">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_multi_dimensional_coords">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_multi_dimensional_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that no multidimensional coordinate shares a name with its</span>
<span class="sd">        dimensions.</span>

<span class="sd">        Chapter 5 paragraph 4</span>

<span class="sd">        We recommend that the name of a [multidimensional coordinate] should</span>
<span class="sd">        not match the name of any of its dimensions.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># This can only apply to auxiliary coordinate variables</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_aux_coord_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">not_matching</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;5&quot;</span><span class="p">])</span>

            <span class="n">not_matching</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">coord</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variable</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">coord</span><span class="si">}</span><span class="s2"> shares the same name as one of its dimensions&quot;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">not_matching</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="c1"># NOTE **********</span>
    <span class="c1"># IS THIS EVEN NEEDED ANYMORE?</span>
    <span class="c1"># ***************</span>
<div class="viewcode-block" id="CF1_6Check.check_grid_coordinates">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_grid_coordinates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_grid_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        5.6 When the coordinate variables for a horizontal grid are not</span>
<span class="sd">        longitude and latitude, it is required that the true latitude and</span>
<span class="sd">        longitude coordinates be supplied via the coordinates attribute.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">latitudes</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_true_latitude_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">longitudes</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_true_longitude_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="n">check_features</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;2d-regular-grid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;2d-static-grid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;3d-regular-grid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;3d-static-grid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mapped-grid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;reduced-grid&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># This one is tricky because there&#39;s a very subtle difference between</span>
        <span class="c1"># latitude as defined in Chapter 4 and &quot;true&quot; latitude as defined in</span>
        <span class="c1"># chapter 5.</span>

        <span class="c1"># For each geophysical variable that defines a grid, assert it is</span>
        <span class="c1"># associated with a true latitude or longitude coordinate.</span>

        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_geophysical_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
            <span class="c1"># We use a set so we can do set-wise comparisons with coordinate</span>
            <span class="c1"># dimensions</span>
            <span class="n">dimensions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>
            <span class="c1"># If it&#39;s not a grid, skip it</span>
            <span class="k">if</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">guess_feature_type</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">check_features</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">has_coords</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;5.6&quot;</span><span class="p">])</span>

            <span class="c1"># axis_map is a defaultdict(list) mapping the axis to a list of</span>
            <span class="c1"># coordinate names. For example:</span>
            <span class="c1"># {&#39;X&#39;: [&#39;lon&#39;], &#39;Y&#39;:[&#39;lat&#39;], &#39;Z&#39;:[&#39;lev&#39;]}</span>
            <span class="c1"># The mapping comes from the dimensions of the variable and the</span>
            <span class="c1"># contents of the `coordinates` attribute only.</span>
            <span class="n">axis_map</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_axis_map</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s1">s coordinate variable &quot;</span><span class="si">{}</span><span class="s1">&quot; is not one of the variables identifying true &#39;</span>
                <span class="o">+</span> <span class="s2">&quot;latitude/longitude and its dimensions are not a subset of </span><span class="si">{}</span><span class="s2">&#39;s dimensions&quot;</span>
            <span class="p">)</span>

            <span class="n">alt</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> has no coordinate associated with a variable identified as true latitude/longitude; &quot;</span>
                <span class="s2">&quot;its coordinate variable should also share a subset of </span><span class="si">{}</span><span class="s2">&#39;s dimensions&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Make sure we can find latitude and its dimensions are a subset</span>
            <span class="n">_lat</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">found_lat</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">axis_map</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]:</span>
                <span class="n">_lat</span> <span class="o">=</span> <span class="n">lat</span>
                <span class="n">is_subset_dims</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">lat</span><span class="p">]</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">is_subset_dims</span> <span class="ow">and</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">latitudes</span><span class="p">:</span>
                    <span class="n">found_lat</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">_lat</span><span class="p">:</span>
                <span class="n">has_coords</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span><span class="n">found_lat</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">_lat</span><span class="p">,</span> <span class="n">variable</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">has_coords</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span><span class="n">found_lat</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">variable</span><span class="p">))</span>

            <span class="c1"># Make sure we can find longitude and its dimensions are a subset</span>
            <span class="n">_lon</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">found_lon</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">axis_map</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]:</span>
                <span class="n">_lon</span> <span class="o">=</span> <span class="n">lon</span>
                <span class="n">is_subset_dims</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">lon</span><span class="p">]</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">is_subset_dims</span> <span class="ow">and</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">longitudes</span><span class="p">:</span>
                    <span class="n">found_lon</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">_lon</span><span class="p">:</span>
                <span class="n">has_coords</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span><span class="n">found_lon</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">_lon</span><span class="p">,</span> <span class="n">variable</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">has_coords</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span><span class="n">found_lon</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">variable</span><span class="p">))</span>

            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">has_coords</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_reduced_horizontal_grid">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_reduced_horizontal_grid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_reduced_horizontal_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        5.3 A &quot;reduced&quot; longitude-latitude grid is one in which the points are</span>
<span class="sd">        arranged along constant latitude lines with the number of points on a</span>
<span class="sd">        latitude line decreasing toward the poles.</span>

<span class="sd">        Recommend that this type of gridded data be stored using the compression</span>
<span class="sd">        scheme described in Section 8.2, &quot;Compression by Gathering&quot;. The</span>
<span class="sd">        compressed latitude and longitude auxiliary coordinate variables are</span>
<span class="sd">        identified by the coordinates attribute.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Create a set of coordinate variables defining `compress`</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cfutil</span><span class="o">.</span><span class="n">get_latitude_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">))</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cfutil</span><span class="o">.</span><span class="n">get_longitude_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_geophysical_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">axis_map</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_axis_map</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="c1"># If this variable has no coordinate that defines compression</span>
            <span class="k">if</span> <span class="s2">&quot;C&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axis_map</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">valid_rgrid</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;5.3&quot;</span><span class="p">])</span>
            <span class="c1"># Make sure reduced grid features define coordinates</span>
            <span class="n">valid_rgrid</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">coords</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;reduced grid feature </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must define coordinates attribute&quot;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># We can&#39;t check anything else if there are no defined coordinates</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">coords</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">coord_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

            <span class="c1"># Make sure it&#39;s associated with valid lat and valid lon</span>
            <span class="n">valid_rgrid</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">coord_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be associated with a valid longitude coordinate&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">valid_rgrid</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">coord_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be associated with a valid latitude coordinate&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">valid_rgrid</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">axis_map</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> can not be associated with more than one compressed coordinates: &quot;</span>
                <span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">axis_map</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">])),</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">compressed_coord</span> <span class="ow">in</span> <span class="n">axis_map</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]:</span>
                <span class="n">coord</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">compressed_coord</span><span class="p">]</span>
                <span class="n">compress</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="s2">&quot;compress&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">valid_rgrid</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">compress</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">compress</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;compress attribute for compression coordinate </span><span class="si">{</span><span class="n">compressed_coord</span><span class="si">}</span><span class="s2"> must be a non-empty string&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compress</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">compress</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                    <span class="n">valid_rgrid</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                        <span class="n">dim</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;dimension </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2"> referenced by </span><span class="si">{</span><span class="n">compressed_coord</span><span class="si">}</span><span class="s2">:compress must exist&quot;</span>
                        <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_rgrid</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_grid_mapping_attr_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate a condition (or series of conditions) for a particular</span>
<span class="sd">        attribute. Implementation for CF-1.6.</span>

<span class="sd">        :param attr: attribute to teset condition for</span>
<span class="sd">        :param str attr_name: name of the attribute</span>
<span class="sd">        :rtype tuple</span>
<span class="sd">        :return two-tuple of (bool, str)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">attr_name</span> <span class="o">==</span> <span class="s2">&quot;latitude_of_projection_origin&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_latitude_of_projection_origin</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">attr_name</span> <span class="o">==</span> <span class="s2">&quot;longitude_of_projection_origin&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_longitude_of_projection_origin</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">attr_name</span> <span class="o">==</span> <span class="s2">&quot;longitude_of_central_meridian&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_longitude_of_central_meridian</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">attr_name</span> <span class="o">==</span> <span class="s2">&quot;longitude_of_prime_meridian&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_longitude_of_prime_meridian</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">attr_name</span> <span class="o">==</span> <span class="s2">&quot;scale_factor_at_central_meridian&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_scale_factor_at_central_meridian</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">attr_name</span> <span class="o">==</span> <span class="s2">&quot;scale_factor_at_projection_origin&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_scale_factor_at_projection_origin</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">attr_name</span> <span class="o">==</span> <span class="s2">&quot;standard_parallel&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_standard_parallel</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">attr_name</span> <span class="o">==</span> <span class="s2">&quot;straight_vertical_longitude_from_pole&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_straight_vertical_longitude_from_pole</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Evaluation for </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> not yet implemented&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_latitude_of_projection_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the condition for `latitude_of_projection_origin` attribute.</span>
<span class="sd">        Return result. Value must be -90 &lt;= x &lt;= 90.</span>

<span class="sd">        :param val: value to be tested</span>
<span class="sd">        :rtype tuple</span>
<span class="sd">        :return two-tuple (bool, msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">val</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">90.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">90.0</span><span class="p">),</span>
            <span class="s2">&quot;latitude_of_projection_origin must satisfy (-90 &lt;= x &lt;= 90)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_longitude_of_projection_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the condition for `longitude_of_projection_origin` attribute.</span>
<span class="sd">        Return result.</span>

<span class="sd">        :param val: value to be tested</span>
<span class="sd">        :rtype tuple</span>
<span class="sd">        :return two-tuple (bool, msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">val</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">180.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">180.0</span><span class="p">),</span>
            <span class="s2">&quot;longitude_of_projection_origin must satisfy (-180 &lt;= x &lt;= 180)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_longitude_of_central_meridian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the condition for `longitude_of_central_meridian` attribute.</span>
<span class="sd">        Return result.</span>

<span class="sd">        :param val: value to be tested</span>
<span class="sd">        :rtype tuple</span>
<span class="sd">        :return two-tuple (bool, msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">val</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">180.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">180.0</span><span class="p">),</span>
            <span class="s2">&quot;longitude_of_central_meridian must satisfy (-180 &lt;= x &lt;= 180)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_longitude_of_prime_meridian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the condition for `longitude_of_prime_meridian` attribute.</span>
<span class="sd">        Return result.</span>

<span class="sd">        :param val: value to be tested</span>
<span class="sd">        :rtype tuple</span>
<span class="sd">        :return two-tuple (bool, msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">val</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">180.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">180.0</span><span class="p">),</span>
            <span class="s2">&quot;longitude_of_prime_meridian must satisfy (-180 &lt;= x &lt;= 180)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_scale_factor_at_central_meridian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the condition for `scale_factor_at_central_meridian` attribute.</span>
<span class="sd">        Return result.</span>

<span class="sd">        :param val: value to be tested</span>
<span class="sd">        :rtype tuple</span>
<span class="sd">        :return two-tuple (bool, msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;scale_factor_at_central_meridian must be &gt; 0.0&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_scale_factor_at_projection_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the condition for `scale_factor_at_projection_origin` attribute.</span>
<span class="sd">        Return result.</span>

<span class="sd">        :param val: value to be tested</span>
<span class="sd">        :rtype tuple</span>
<span class="sd">        :return two-tuple (bool, msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;scale_factor_at_projection_origin must be &gt; 0.0&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_standard_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the condition for `standard_parallel` attribute. Return result.</span>

<span class="sd">        :param val: value to be tested</span>
<span class="sd">        :rtype tuple</span>
<span class="sd">        :return two-tuple (bool, msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">val</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">90.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">),</span>
            <span class="s2">&quot;standard_parallel must satisfy (-90 &lt;= x &lt;= 90)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_straight_vertical_longitude_from_pole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the condition for `straight_vertical_longitude_from_pole`</span>
<span class="sd">        attribute. Return result.</span>

<span class="sd">        :param val: value to be tested</span>
<span class="sd">        :rtype tuple</span>
<span class="sd">        :return two-tuple (bool, msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">val</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">180.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">),</span>
            <span class="s2">&quot;straight_vertical_longitude_from_pole must satisfy (-180 &lt;= x &lt;= 180)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1">###############################################################################</span>
    <span class="c1"># Chapter 6: Labels and Alternative Coordinates</span>
    <span class="c1">###############################################################################</span>

<div class="viewcode-block" id="CF1_6Check.check_geographic_region">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_geographic_region">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_geographic_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        6.1.1 When data is representative of geographic regions which can be identified by names but which have complex</span>
<span class="sd">        boundaries that cannot practically be specified using longitude and latitude boundary coordinates, a labeled</span>
<span class="sd">        axis should be used to identify the regions.</span>

<span class="sd">        Recommend that the names be chosen from the list of standardized region names whenever possible. To indicate</span>
<span class="sd">        that the label values are standardized the variable that contains the labels must be given the standard_name</span>
<span class="sd">        attribute with the value region.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">region_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span>  <span class="c1"># TODO maybe move this (and other info like it) into a config file?</span>
                <span class="s2">&quot;africa&quot;</span><span class="p">,</span>
                <span class="s2">&quot;antarctica&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arabian_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;aral_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arctic_ocean&quot;</span><span class="p">,</span>
                <span class="s2">&quot;asia&quot;</span><span class="p">,</span>
                <span class="s2">&quot;atlantic_ocean&quot;</span><span class="p">,</span>
                <span class="s2">&quot;australia&quot;</span><span class="p">,</span>
                <span class="s2">&quot;baltic_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;barents_opening&quot;</span><span class="p">,</span>
                <span class="s2">&quot;barents_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;beaufort_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bellingshausen_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bering_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bering_strait&quot;</span><span class="p">,</span>
                <span class="s2">&quot;black_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;canadian_archipelago&quot;</span><span class="p">,</span>
                <span class="s2">&quot;caribbean_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;caspian_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;central_america&quot;</span><span class="p">,</span>
                <span class="s2">&quot;chukchi_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;contiguous_united_states&quot;</span><span class="p">,</span>
                <span class="s2">&quot;denmark_strait&quot;</span><span class="p">,</span>
                <span class="s2">&quot;drake_passage&quot;</span><span class="p">,</span>
                <span class="s2">&quot;east_china_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;english_channel&quot;</span><span class="p">,</span>
                <span class="s2">&quot;eurasia&quot;</span><span class="p">,</span>
                <span class="s2">&quot;europe&quot;</span><span class="p">,</span>
                <span class="s2">&quot;faroe_scotland_channel&quot;</span><span class="p">,</span>
                <span class="s2">&quot;florida_bahamas_strait&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fram_strait&quot;</span><span class="p">,</span>
                <span class="s2">&quot;global&quot;</span><span class="p">,</span>
                <span class="s2">&quot;global_land&quot;</span><span class="p">,</span>
                <span class="s2">&quot;global_ocean&quot;</span><span class="p">,</span>
                <span class="s2">&quot;great_lakes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;greenland&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gulf_of_alaska&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gulf_of_mexico&quot;</span><span class="p">,</span>
                <span class="s2">&quot;hudson_bay&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iceland_faroe_channel&quot;</span><span class="p">,</span>
                <span class="s2">&quot;indian_ocean&quot;</span><span class="p">,</span>
                <span class="s2">&quot;indonesian_throughflow&quot;</span><span class="p">,</span>
                <span class="s2">&quot;indo_pacific_ocean&quot;</span><span class="p">,</span>
                <span class="s2">&quot;irish_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lake_baykal&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lake_chad&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lake_malawi&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lake_tanganyika&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lake_victoria&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mediterranean_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mozambique_channel&quot;</span><span class="p">,</span>
                <span class="s2">&quot;north_america&quot;</span><span class="p">,</span>
                <span class="s2">&quot;north_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;norwegian_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pacific_equatorial_undercurrent&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pacific_ocean&quot;</span><span class="p">,</span>
                <span class="s2">&quot;persian_gulf&quot;</span><span class="p">,</span>
                <span class="s2">&quot;red_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ross_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sea_of_japan&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sea_of_okhotsk&quot;</span><span class="p">,</span>
                <span class="s2">&quot;south_america&quot;</span><span class="p">,</span>
                <span class="s2">&quot;south_china_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;southern_ocean&quot;</span><span class="p">,</span>
                <span class="s2">&quot;taiwan_luzon_straits&quot;</span><span class="p">,</span>
                <span class="s2">&quot;weddell_sea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;windward_passage&quot;</span><span class="p">,</span>
                <span class="s2">&quot;yellow_sea&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span><span class="n">standard_name</span><span class="o">=</span><span class="s2">&quot;region&quot;</span><span class="p">):</span>
            <span class="n">valid_region</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;6.1&quot;</span><span class="p">])</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">region</span><span class="p">):</span>
                <span class="n">region</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">data</span>
            <span class="n">valid_region</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">region_list</span><span class="p">,</span>
                <span class="s2">&quot;6.1.1 &#39;</span><span class="si">{}</span><span class="s2">&#39; specified by &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid region&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_region</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="c1">###############################################################################</span>
    <span class="c1"># Chapter 7: Data Representative of Cells</span>
    <span class="c1">###############################################################################</span>

<div class="viewcode-block" id="CF1_6Check.check_cell_boundaries">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_cell_boundaries">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_cell_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the dimensions of cell boundary variables to ensure they are CF compliant.</span>

<span class="sd">        7.1 To represent cells we add the attribute bounds to the appropriate coordinate variable(s). The value of bounds</span>
<span class="sd">        is the name of the variable that contains the vertices of the cell boundaries. We refer to this type of variable as</span>
<span class="sd">        a &quot;boundary variable.&quot; A boundary variable will have one more dimension than its associated coordinate or auxiliary</span>
<span class="sd">        coordinate variable. The additional dimension should be the most rapidly varying one, and its size is the maximum</span>
<span class="sd">        number of cell vertices.</span>

<span class="sd">        Applications that process cell boundary data often times need to determine whether or not adjacent cells share an</span>
<span class="sd">        edge. In order to facilitate this type of processing the following restrictions are placed on the data in boundary</span>
<span class="sd">        variables:</span>

<span class="sd">        Bounds for 1-D coordinate variables</span>

<span class="sd">            For a coordinate variable such as lat(lat) with associated boundary variable latbnd(x,2), the interval endpoints</span>
<span class="sd">            must be ordered consistently with the associated coordinate, e.g., for an increasing coordinate, lat(1) &gt; lat(0)</span>
<span class="sd">            implies latbnd(i,1) &gt;= latbnd(i,0) for all i</span>

<span class="sd">            If adjacent intervals are contiguous, the shared endpoint must be represented identically in each instance where</span>
<span class="sd">            it occurs in the boundary variable. For example, if the intervals that contain grid points lat(i) and lat(i+1) are</span>
<span class="sd">            contiguous, then latbnd(i+1,0) = latbnd(i,1).</span>

<span class="sd">        Bounds for 2-D coordinate variables with 4-sided cells</span>

<span class="sd">            In the case where the horizontal grid is described by two-dimensional auxiliary coordinate variables in latitude</span>
<span class="sd">            lat(n,m) and longitude lon(n,m), and the associated cells are four-sided, then the boundary variables are given</span>
<span class="sd">            in the form latbnd(n,m,4) and lonbnd(n,m,4), where the trailing index runs over the four vertices of the cells.</span>

<span class="sd">        Bounds for multi-dimensional coordinate variables with p-sided cells</span>

<span class="sd">            In all other cases, the bounds should be dimensioned (...,n,p), where (...,n) are the dimensions of the auxiliary</span>
<span class="sd">            coordinate variables, and p the number of vertices of the cells. The vertices must be traversed anticlockwise in the</span>
<span class="sd">            lon-lat plane as viewed from above. The starting vertex is not specified.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Note that test does not check monotonicity</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reasoning</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">boundary_variable_name</span> <span class="ow">in</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_cell_boundary_map</span><span class="p">(</span>
            <span class="n">ds</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">reasoning</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">boundary_variable_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Boundary variable </span><span class="si">{</span><span class="n">boundary_variable_name</span><span class="si">}</span><span class="s2"> referenced by </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> not &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;found in dataset variables&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">boundary_variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">boundary_variable_name</span><span class="p">]</span>
            <span class="c1"># The number of dimensions in the bounds variable should always be</span>
            <span class="c1"># the number of dimensions in the referring variable + 1</span>
            <span class="k">if</span> <span class="n">boundary_variable</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Boundary variable </span><span class="si">{</span><span class="n">boundary_variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> specified by </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; should have at least two dimensions to enclose the base &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;case of a one dimensionsal variable&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">boundary_variable</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="n">variable</span><span class="o">.</span><span class="n">ndim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The number of dimensions of the variable </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">, but the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;number of dimensions of the boundary variable </span><span class="si">{</span><span class="n">boundary_variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">boundary_variable</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">. The boundary variable &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;should have </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">ndim</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> dimensions&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[:]</span> <span class="o">!=</span> <span class="n">boundary_variable</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[:</span> <span class="n">variable</span><span class="o">.</span><span class="n">ndim</span><span class="p">]:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Boundary variable coordinates (for </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">) are in improper order: </span><span class="si">{</span><span class="n">boundary_variable</span><span class="o">.</span><span class="n">dimensions</span><span class="si">}</span><span class="s2">. Bounds-specific dimensions should be last&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># ensure p vertices form a valid simplex given previous a...n</span>
            <span class="c1"># previous auxiliary coordinates</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">boundary_variable</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">size</span>
                <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundary_variable</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Dimension </span><span class="si">{</span><span class="n">boundary_variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> of boundary variable (for </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">) must have at least </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> elements to form a simplex/closed cell with previous dimensions </span><span class="si">{</span><span class="n">boundary_variable</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">valid</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.1&quot;</span><span class="p">],</span>
                <span class="n">reasoning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_cell_measures_core</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">external_set</span><span class="p">,</span> <span class="n">variable_template</span><span class="p">):</span>
        <span class="c1"># IMPLEMENTATION CONFORMANCE REQUIRED 1/2</span>
        <span class="n">reasoning</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">search_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;^(?P&lt;measure_type&gt;area|volume):\s+(?P&lt;cell_measure_var_name&gt;\w+)$&quot;</span>
        <span class="p">)</span>
        <span class="n">search_res</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">search_str</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">cell_measures</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">search_res</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The cell_measures attribute for variable </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;is formatted incorrectly. It should take the &quot;</span>
                <span class="s2">&quot;form of either &#39;area: cell_var&#39; or &quot;</span>
                <span class="s2">&quot;&#39;volume: cell_var&#39; where cell_var is an existing name of &quot;</span>
                <span class="s2">&quot;a variable describing the cell measures.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cell_measure_var_name</span> <span class="o">=</span> <span class="n">search_res</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;cell_measure_var_name&quot;</span><span class="p">)</span>
            <span class="n">cell_measure_type</span> <span class="o">=</span> <span class="n">search_res</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;measure_type&quot;</span><span class="p">)</span>
            <span class="c1"># TODO: cache previous results</span>
            <span class="k">if</span> <span class="n">cell_measure_var_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
                <span class="n">external_set</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cell measure variable </span><span class="si">{</span><span class="n">cell_measure_var_name</span><span class="si">}</span><span class="s2"> referred to by &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not present in </span><span class="si">{</span><span class="n">variable_template</span><span class="si">}</span><span class="s2">s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">cell_measure_var_name</span><span class="p">,</span>
                        <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="c1"># CF 1.7+ assume external variables -- further checks can&#39;t be run here</span>
            <span class="k">elif</span> <span class="n">cell_measure_var_name</span> <span class="ow">in</span> <span class="n">external_set</span><span class="p">:</span>
                <span class="c1"># can&#39;t test anything on an external var</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                    <span class="n">valid</span><span class="p">,</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.2&quot;</span><span class="p">]),</span>
                    <span class="n">reasoning</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">cell_measure_var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">cell_measure_var_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cell_measure_var</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">):</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Cell measure variable </span><span class="si">{</span><span class="n">cell_measure_var_name</span><span class="si">}</span><span class="s2"> is required &quot;</span>
                        <span class="s2">&quot;to have units attribute defined&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># IMPLEMENTATION CONFORMANCE REQUIRED 2/2</span>
                    <span class="c1"># verify this combination {area: &#39;m2&#39;, volume: &#39;m3&#39;}</span>

                    <span class="c1"># key is valid measure types, value is expected</span>
                    <span class="c1"># exponent</span>
                    <span class="n">exponent_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
                    <span class="n">exponent</span> <span class="o">=</span> <span class="n">exponent_lookup</span><span class="p">[</span><span class="n">search_res</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;measure_type&quot;</span><span class="p">)]</span>
                    <span class="n">conversion_failure_msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Variable &quot;</span><span class="si">{</span><span class="n">cell_measure_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot; must have units which are convertible &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;to UDUNITS &quot;m</span><span class="si">{</span><span class="n">exponent</span><span class="si">}</span><span class="s1">&quot; when variable is referred to by a </span><span class="si">{</span><span class="n">variable_template</span><span class="si">}</span><span class="s1"> with &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;cell_methods attribute with a measure type of &quot;</span><span class="si">{</span><span class="n">cell_measure_type</span><span class="si">}</span><span class="s1">&quot;.&#39;</span>
                    <span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">cell_measure_units</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">cell_measure_var</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conversion_failure_msg</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">cell_measure_units</span><span class="o">.</span><span class="n">is_convertible</span><span class="p">(</span>
                            <span class="n">Unit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m</span><span class="si">{</span><span class="n">exponent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
                        <span class="p">):</span>
                            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conversion_failure_msg</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">cell_measure_var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">):</span>
                        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Cell measure variable </span><span class="si">{</span><span class="n">cell_measure_var_name</span><span class="si">}</span><span class="s2"> must have &quot;</span>
                            <span class="s2">&quot;dimensions which are a subset of &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;those defined in variable </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
                        <span class="p">)</span>

        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.2&quot;</span><span class="p">]),</span> <span class="n">reasoning</span><span class="p">)</span>

<div class="viewcode-block" id="CF1_6Check.check_cell_measures">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_cell_measures">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_cell_measures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        7.2 To indicate extra information about the spatial properties of a</span>
<span class="sd">        variable&#39;s grid cells, a cell_measures attribute may be defined for a</span>
<span class="sd">        variable. This is a string attribute comprising a list of</span>
<span class="sd">        blank-separated pairs of words of the form &quot;measure: name&quot;. &quot;area&quot; and</span>
<span class="sd">        &quot;volume&quot; are the only defined measures.</span>

<span class="sd">        The &quot;name&quot; is the name of the variable containing the measure values,</span>
<span class="sd">        which we refer to as a &quot;measure variable&quot;. The dimensions of the</span>
<span class="sd">        measure variable should be the same as or a subset of the dimensions of</span>
<span class="sd">        the variable to which they are related, but their order is not</span>
<span class="sd">        restricted.</span>

<span class="sd">        The variable must have a units attribute and may have other attributes</span>
<span class="sd">        such as a standard_name.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span>
            <span class="n">cell_measures</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_measures_core</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="nb">set</span><span class="p">(),</span> <span class="s2">&quot;dataset variable&quot;</span><span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_cell_methods">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_cell_methods">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_cell_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        7.3 To describe the characteristic of a field that is represented by cell values, we define the cell_methods attribute</span>
<span class="sd">        of the variable. This is a string attribute comprising a list of blank-separated words of the form &quot;name: method&quot;. Each</span>
<span class="sd">        &quot;name: method&quot; pair indicates that for an axis identified by name, the cell values representing the field have been</span>
<span class="sd">        determined or derived by the specified method.</span>

<span class="sd">        name can be a dimension of the variable, a scalar coordinate variable, a valid standard name, or the word &quot;area&quot;</span>

<span class="sd">        values of method should be selected from the list in Appendix E, Cell Methods, which includes point, sum, mean, maximum,</span>
<span class="sd">        minimum, mid_range, standard_deviation, variance, mode, and median. Case is not significant in the method name. Some</span>
<span class="sd">        methods (e.g., variance) imply a change of units of the variable, as is indicated in Appendix E, Cell Methods.</span>

<span class="sd">        Because the default interpretation for an intensive quantity differs from that of an extensive quantity and because this</span>
<span class="sd">        distinction may not be understood by some users of the data, it is recommended that every data variable include for each</span>
<span class="sd">        of its dimensions and each of its scalar coordinate variables the cell_methods information of interest (unless this</span>
<span class="sd">        information would not be meaningful). It is especially recommended that cell_methods be explicitly specified for each</span>
<span class="sd">        spatio-temporal dimension and each spatio-temporal scalar coordinate variable.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># CONFORMANCE IMPLEMENTATION 7.3 1/3</span>
        <span class="n">psep</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;(?P&lt;vars&gt;\w+: )+(?P&lt;method&gt;\w+) ?(?P&lt;where&gt;where (?P&lt;wtypevar&gt;\w+) &quot;</span>
            <span class="sa">r</span><span class="s2">&quot;?(?P&lt;over&gt;over (?P&lt;otypevar&gt;\w+))?| ?)(?:\((?P&lt;paren_contents&gt;[^)]*)\))?&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span><span class="n">cell_methods</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;cell_methods&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;cell_methods&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">valid_attribute</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span>
                <span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.3&quot;</span><span class="p">],</span>
            <span class="p">)</span>  <span class="c1"># changed from 7.1 to 7.3</span>
            <span class="n">valid_attribute</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">psep</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">&quot; is not a valid format for cell_methods attribute of &quot;</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_attribute</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

            <span class="n">valid_cell_names</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.3&quot;</span><span class="p">])</span>

            <span class="c1"># check that the name is valid</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">regex</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">psep</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
                <span class="c1"># it is possible to have &quot;var1: var2: ... varn: ...&quot;, so handle</span>
                <span class="c1"># that case</span>
                <span class="k">for</span> <span class="n">var_raw_str</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">captures</span><span class="p">(</span><span class="s2">&quot;vars&quot;</span><span class="p">):</span>
                    <span class="c1"># strip off the &#39; :&#39; at the end of each match</span>
                    <span class="n">var_str</span> <span class="o">=</span> <span class="n">var_raw_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">var_str</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">dimensions</span>
                        <span class="ow">or</span> <span class="n">var_str</span> <span class="o">==</span> <span class="s2">&quot;area&quot;</span>
                        <span class="ow">or</span> <span class="n">var_str</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="n">valid_cell_names</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                        <span class="n">valid</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;s cell_methods name component </span><span class="si">{</span><span class="n">var_str</span><span class="si">}</span><span class="s2"> does not match a dimension, &quot;</span>
                        <span class="s2">&quot;area or auxiliary coordinate&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_cell_names</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

            <span class="c1"># Checks if the method value of the &#39;name: method&#39; pair is acceptable</span>
            <span class="n">valid_cell_methods</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.3&quot;</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">regex</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">psep</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
                <span class="c1"># CF section 7.3 - &quot;Case is not significant in the method name.&quot;</span>
                <span class="n">valid_cell_methods</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                    <span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">,</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:cell_methods contains an invalid method: </span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)),</span>
                <span class="p">)</span>

            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_cell_methods</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">regex</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">psep</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;paren_contents&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># split along spaces followed by words with a colon</span>
                    <span class="c1"># not sure what to do if a comment contains a colon!</span>
                    <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_check_cell_methods_paren_info</span><span class="p">(</span>
                            <span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;paren_contents&quot;</span><span class="p">),</span>
                            <span class="n">var</span><span class="p">,</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">to_result</span><span class="p">(),</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_cell_methods_paren_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paren_contents</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that the spacing and/or comment info contained inside the</span>
<span class="sd">        parentheses in cell_methods is well-formed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># IMPLEMENTATION CONFORMANCE REQUIRED 3/3 - comment/paren contents</span>
        <span class="n">valid_info</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.3&quot;</span><span class="p">])</span>
        <span class="c1"># if there are no colons, this is a simple comment</span>
        <span class="c1"># TODO: are empty comments considered valid?</span>
        <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">paren_contents</span><span class="p">:</span>
            <span class="n">valid_info</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">valid_info</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">valid_info</span>
        <span class="c1"># otherwise, split into k/v pairs</span>
        <span class="n">kv_pair_pat</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(\S+:)\s+(.*(?=\s+\w+:)|[^:]+$)\s*&quot;</span>
        <span class="c1"># otherwise, we must split further with intervals coming</span>
        <span class="c1"># first, followed by non-standard comments</span>
        <span class="c1"># we need the count of the matches, and re.findall() only returns</span>
        <span class="c1"># groups if they are present and we wish to see if the entire match</span>
        <span class="c1"># object concatenated together is the same as the original string</span>
        <span class="n">pmatches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">kv_pair_pat</span><span class="p">,</span> <span class="n">paren_contents</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pmatch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pmatches</span><span class="p">):</span>
            <span class="n">keyword</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">pmatch</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;interval:&quot;</span><span class="p">:</span>
                <span class="n">valid_info</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="n">interval_matches</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;^\s*(?P&lt;interval_number&gt;\S+)\s+(?P&lt;interval_units&gt;\S+)\s*$&quot;</span><span class="p">,</span>
                    <span class="n">val</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># attempt to get the number for the interval</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">interval_matches</span><span class="p">:</span>
                    <span class="n">valid_info</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;§7.3.3 </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">:cell_methods contains an interval specification that does not parse: &quot;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1">&quot;. Should be in format &quot;interval: &lt;number&gt; &lt;units&gt;&quot;&#39;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">interval_matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;interval_number&quot;</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">valid_info</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="s1">&#39;§7.3.3 </span><span class="si">{}</span><span class="s1">:cell_methods contains an interval value that does not parse as a numeric value: &quot;</span><span class="si">{}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                <span class="n">interval_matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;interval_number&quot;</span><span class="p">),</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">valid_info</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="c1"># then the units</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">Unit</span><span class="p">(</span><span class="n">interval_matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;interval_units&quot;</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">valid_info</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="s1">&#39;§7.3.3 </span><span class="si">{}</span><span class="s1">:cell_methods interval units &quot;</span><span class="si">{}</span><span class="s1">&quot; is not parsable by UDUNITS.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                <span class="n">interval_matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;interval_units&quot;</span><span class="p">),</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">valid_info</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;comment:&quot;</span><span class="p">:</span>
                <span class="c1"># comments can&#39;t really be invalid, except</span>
                <span class="c1"># if they come first or aren&#39;t last, and</span>
                <span class="c1"># maybe if they contain colons embedded in the</span>
                <span class="c1"># comment string</span>
                <span class="n">valid_info</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pmatches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">valid_info</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;§7.3.3 If there is no standardized information, the keyword comment: should be omitted for variable </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="c1"># otherwise check that the comment is the last</span>
                <span class="c1"># item in the parentheses</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pmatches</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">valid_info</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;§7.3.3 The non-standard &quot;comment:&quot; element must come after any standard elements in cell_methods for variable </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="c1">#</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">valid_info</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valid_info</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">valid_info</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;§7.3.3 Invalid cell_methods keyword &quot;</span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="s1">&quot; for variable </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">. Must be one of [interval, comment]&#39;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Ensure concatenated reconstructed matches are the same as the</span>
        <span class="c1"># original string.  If they&#39;re not, there&#39;s likely a formatting error</span>
        <span class="n">valid_info</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">pmatches</span><span class="p">)</span> <span class="o">==</span> <span class="n">paren_contents</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;§7.3.3 Parenthetical content inside </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:cell_methods is not well formed: </span><span class="si">{</span><span class="n">paren_contents</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">valid_info</span>

<div class="viewcode-block" id="CF1_6Check.check_climatological_statistics">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_climatological_statistics">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_climatological_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        7.4 A climatological time coordinate variable does not have a bounds attribute. Instead, it has a climatology</span>
<span class="sd">        attribute, which names a variable with dimensions (n,2), n being the dimension of the climatological time axis.</span>
<span class="sd">        Using the units and calendar of the time coordinate variable, element (i,0) of the climatology variable specifies</span>
<span class="sd">        the beginning of the first subinterval and element (i,1) the end of the last subinterval used to evaluate the</span>
<span class="sd">        climatological statistics with index i in the time dimension. The time coordinates should be values that are</span>
<span class="sd">        representative of the climatological time intervals, such that an application which does not recognise climatological</span>
<span class="sd">        time will nonetheless be able to make a reasonable interpretation.</span>

<span class="sd">        A climatological axis may use different statistical methods to measure variation among years, within years, and within</span>
<span class="sd">        days. The methods which can be specified are those listed in Appendix E, Cell Methods and each entry in the cell_methods</span>
<span class="sd">        attribute may also contain non-standardised information in parentheses after the method. The value of the cell_method</span>
<span class="sd">        attribute must be in one of the following forms:</span>
<span class="sd">        - time: method1 within years   time: method2 over years</span>
<span class="sd">        - time: method1 within days    time: method2 over days</span>
<span class="sd">        - time: method1 within days    time: method2 over days   time: method3 over years</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">reasoning</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_climate_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_climate_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">all_clim_coord_var_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;point&quot;</span><span class="p">,</span>  <span class="c1"># TODO change to appendix import once cf1.7 merged</span>
            <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;maximum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;minimum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mid_range&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_deviation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;variance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;median&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># find any climatology axis variables; any variables which contain climatological stats will use</span>
        <span class="c1"># these variables as coordinates</span>
        <span class="n">clim_time_coord_vars</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span>
            <span class="n">climatology</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># first, to determine whether or not we have a valid climatological time</span>
        <span class="c1"># coordinate variable, we need to make sure it has the attribute &quot;climatology&quot;,</span>
        <span class="c1"># but not the attribute &quot;bounds&quot;</span>
        <span class="n">time_vars</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_time_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">clim_coord_var</span> <span class="ow">in</span> <span class="n">clim_time_coord_vars</span><span class="p">:</span>
            <span class="n">climatology_ctx</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.3&quot;</span><span class="p">])</span>
            <span class="c1"># IMPLEMENTATION CONFORMANCE 7.4 REQUIRED 1/6</span>
            <span class="k">if</span> <span class="n">clim_coord_var</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">time_vars</span><span class="p">:</span>
                <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">clim_coord_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not detected as a time &quot;</span>
                    <span class="s2">&quot;coordinate variable, but has climatology attribute&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># IMPLEMENTATION CONFORMANCE 7.4 REQUIRED</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">clim_coord_var</span><span class="p">,</span> <span class="s2">&quot;bounds&quot;</span><span class="p">):</span>
                <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">clim_coord_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has a climatology &quot;</span>
                    <span class="s2">&quot;attribute and cannot also have a bounds attribute.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.4&quot;</span><span class="p">]),</span>
                    <span class="n">reasoning</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># IMPLEMENTATION CONFORMANCE 7.4 REQUIRED 2/6</span>
            <span class="c1"># make sure the climatology variable referenced actually exists</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clim_coord_var</span><span class="o">.</span><span class="n">climatology</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">clim_coord_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> must have a climatology &quot;</span>
                    <span class="s2">&quot;attribute which is a string&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">climatology_ctx</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">clim_coord_var</span><span class="o">.</span><span class="n">climatology</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;Variable </span><span class="si">{}</span><span class="s2"> referenced in time&#39;s climatology attribute does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">climatology</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">clim_var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">clim_coord_var</span><span class="o">.</span><span class="n">climatology</span><span class="p">]</span>
                <span class="c1">#</span>
                <span class="c1"># IMPLEMENTATION CONFORMANCE 7.4 REQUIRED 4/6</span>
                <span class="k">if</span> <span class="n">clim_var</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">clim_var</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
                    <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Climatology variable </span><span class="si">{</span><span class="n">clim_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a numeric type&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="c1"># IMPLEMENTATION CONFORMANCE 7.4 REQUIRED 6/6</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">clim_var</span><span class="p">,</span> <span class="s2">&quot;_FillValue&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span>
                    <span class="n">clim_var</span><span class="p">,</span>
                    <span class="s2">&quot;missing_value&quot;</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">out_of</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Climatology variable </span><span class="si">{</span><span class="n">clim_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> may not contain &quot;</span>
                        <span class="s2">&quot;attributes _FillValue or missing_value&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># IMPLEMENTATION CONFORMANCE 7.4 REQUIRED 5/6</span>
                <span class="k">for</span> <span class="n">same_attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="s2">&quot;calendar&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">clim_var</span><span class="p">,</span> <span class="n">same_attr</span><span class="p">):</span>
                        <span class="n">climatology_ctx</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                            <span class="nb">getattr</span><span class="p">(</span><span class="n">clim_var</span><span class="p">,</span> <span class="n">same_attr</span><span class="p">)</span>
                            <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">clim_coord_var</span><span class="p">,</span> <span class="n">same_attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                            <span class="sa">f</span><span class="s2">&quot;Attribute </span><span class="si">{</span><span class="n">same_attr</span><span class="si">}</span><span class="s2"> must have the same value in both &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;variables </span><span class="si">{</span><span class="n">clim_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">clim_coord_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">climatology_ctx</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

            <span class="c1"># check that coordinate bounds are in the proper order.</span>
            <span class="c1"># make sure last elements are boundary variable specific dimensions</span>
            <span class="c1"># IMPLEMENTATION CONFORMANCE 7.4 REQUIRED 3/6</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">clim_coord_var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[:]</span>
                <span class="o">!=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">clim_coord_var</span><span class="o">.</span><span class="n">climatology</span><span class="p">]</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span>
                    <span class="p">:</span> <span class="n">clim_coord_var</span><span class="o">.</span><span class="n">ndim</span>
                <span class="p">]</span>
            <span class="p">):</span>
                <span class="n">total_climate_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Climatology variable coordinates are in improper order: </span><span class="si">{</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">clim_coord_var</span><span class="o">.</span><span class="n">climatology</span><span class="p">]</span><span class="o">.</span><span class="n">dimensions</span><span class="si">}</span><span class="s2">. Bounds-specific dimensions should be last&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">valid_climate_count</span><span class="p">,</span> <span class="n">total_climate_count</span><span class="p">),</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.4&quot;</span><span class="p">]),</span>
                    <span class="n">reasoning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="c1"># IMPLEMENTATION CONFORMANCE 7.4 REQUIRED 3/6 - dim size of 2 for</span>
            <span class="c1"># climatology-specific dimension</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span>
                    <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">clim_coord_var</span><span class="o">.</span><span class="n">climatology</span><span class="p">]</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
                <span class="o">!=</span> <span class="mi">2</span>
            <span class="p">):</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Climatology dimension &quot;</span><span class="si">{</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">clim_coord_var</span><span class="o">.</span><span class="n">climatology</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot; should only contain two elements&#39;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">total_climate_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">valid_climate_count</span><span class="p">,</span> <span class="n">total_climate_count</span><span class="p">),</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.4&quot;</span><span class="p">]),</span>
                    <span class="n">reasoning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="c1"># passed all these checks, so we can add this clim_coord_var to our total list</span>
            <span class="n">all_clim_coord_var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clim_coord_var</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># for any variables which use a climatology time coordinate variable as a coordinate,</span>
        <span class="c1"># if they have a cell_methods attribute, it must comply with the form:</span>
        <span class="c1">#     time: method1 within years time: method2 over years</span>
        <span class="c1">#     time: method1 within days time: method2 over days</span>
        <span class="c1">#     time: method1 within days time: method2 over days time: method3 over years</span>
        <span class="c1"># optionally followed by parentheses for explaining additional</span>
        <span class="c1"># info, e.g.</span>
        <span class="c1"># &quot;time: method1 within years time: method2 over years (sidereal years)&quot;</span>

        <span class="n">meth_regex</span> <span class="o">=</span> <span class="s2">&quot;(?:</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">methods</span><span class="p">),</span>
        <span class="p">)</span>  <span class="c1"># &quot;or&quot; comparison for the methods</span>
        <span class="n">re_string</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">rf</span><span class="s2">&quot;^time: </span><span class="si">{</span><span class="n">meth_regex</span><span class="si">}</span><span class="s2"> within (years|days)&quot;</span>  <span class="c1"># regex string to test</span>
            <span class="sa">rf</span><span class="s2">&quot; time: </span><span class="si">{</span><span class="n">meth_regex</span><span class="si">}</span><span class="s2"> over \1(:?(?&lt;=days) time: </span><span class="si">{</span><span class="n">meth_regex</span><span class="si">}</span><span class="s2"> over years)?&quot;</span>
            <span class="sa">r</span><span class="s2">&quot;(?: \([^)]+\))?$&quot;</span>  <span class="c1"># parenthesized comment section</span>
        <span class="p">)</span>

        <span class="c1"># find any variables with a valid climatological cell_methods</span>
        <span class="k">for</span> <span class="n">cell_method_var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span>
            <span class="n">cell_methods</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">dim</span> <span class="ow">in</span> <span class="n">all_clim_coord_var_names</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">cell_method_var</span><span class="o">.</span><span class="n">dimensions</span>
            <span class="p">):</span>
                <span class="n">total_climate_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re_string</span><span class="p">,</span> <span class="n">cell_method_var</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">):</span>
                    <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;The &quot;time: method within years/days over years/days&quot; format is not correct in variable </span><span class="si">{</span><span class="n">cell_method_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">valid_climate_count</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                    <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">valid_climate_count</span><span class="p">,</span> <span class="n">total_climate_count</span><span class="p">),</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.4&quot;</span><span class="p">]),</span>
                    <span class="n">reasoning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="c1">###############################################################################</span>
    <span class="c1"># Chapter 8: Reduction of Dataset Size</span>
    <span class="c1">###############################################################################</span>

<div class="viewcode-block" id="CF1_6Check.check_packed_data">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_packed_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_packed_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        8.1 Simple packing may be achieved through the use of the optional NUG defined attributes scale_factor and</span>
<span class="sd">        add_offset. After the data values of a variable have been read, they are to be multiplied by the scale_factor,</span>
<span class="sd">        and have add_offset added to them.</span>

<span class="sd">        The units of a variable should be representative of the unpacked data.</span>

<span class="sd">        If the scale_factor and add_offset attributes are of the same data type as the associated variable, the unpacked</span>
<span class="sd">        data is assumed to be of the same data type as the packed data. However, if the scale_factor and add_offset</span>
<span class="sd">        attributes are of a different data type from the variable (containing the packed data) then the unpacked data</span>
<span class="sd">        should match the type of these attributes, which must both be of type float or both be of type double. An additional</span>
<span class="sd">        restriction in this case is that the variable containing the packed data must be of type byte, short or int. It is</span>
<span class="sd">        not advised to unpack an int into a float as there is a potential precision loss.</span>

<span class="sd">        When data to be packed contains missing values the attributes that indicate missing values (_FillValue, valid_min,</span>
<span class="sd">        valid_max, valid_range) must be of the same data type as the packed data.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">add_offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;add_offset&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;scale_factor&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">add_offset</span> <span class="ow">or</span> <span class="n">scale_factor</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">reasoning</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># if only one of these attributes is defined, assume they</span>
            <span class="c1"># are the same type (value doesn&#39;t matter here)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">add_offset</span><span class="p">:</span>
                <span class="n">add_offset</span> <span class="o">=</span> <span class="n">scale_factor</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scale_factor</span><span class="p">:</span>
                <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">add_offset</span>

            <span class="c1"># IMPLEMENTATION CONFORMANCE 8.1 REQUIRED 1/3</span>
            <span class="c1"># scale_factor and add_offset same type</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">add_offset</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">scale_factor</span><span class="p">)):</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;Attributes add_offset and scale_factor have different data type.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># IMPLEMENTATION CONFORMANCE 8.1 REQUIRED 2/3</span>
            <span class="c1"># scale_factor and add_offset must be floating point or double</span>
            <span class="c1"># if not the same type</span>
            <span class="c1"># FIXME: Check add_offset too.</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale_factor</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">):</span>
                <span class="c1"># Check both attributes are type float or double</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale_factor</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s2">&quot;Attributes add_offset and scale_factor are not of type float or double.&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Check variable type is byte, short or int</span>
                    <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="nb">int</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
                    <span class="p">]:</span>
                        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="c1"># IMPLEMENTATION CONFORMANCE REQUIRED 3/3</span>
                        <span class="c1"># IMPLEMENTATION CONFORMANCE REQUIRED 3/3</span>
                        <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="s2">&quot;Variable is not of type byte, short, or int as required for different type add_offset/scale_factor.&quot;</span><span class="p">,</span>
                        <span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">valid</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;8.1&quot;</span><span class="p">],</span>
                <span class="n">reasoning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">reasoning</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># test further with  _FillValue , valid_min , valid_max , valid_range</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;_FillValue&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">_FillValue</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">var</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Type of </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:_FillValue attribute (</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">_FillValue</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">) does not match variable type (</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;valid_min&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">valid_min</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">var</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Type of </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:valid_min attribute (</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">valid_min</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">) does not match variable type (</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;valid_max&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">valid_max</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">var</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Type of </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:valid_max attribute (</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">valid_max</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">) does not match variable type (</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;valid_range&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">valid_range</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">var</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Type of </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:valid_range attribute (</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">valid_range</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">) does not match variable type (</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="n">valid</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;8.1&quot;</span><span class="p">],</span>
                <span class="n">reasoning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_compression_gathering">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_compression_gathering">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_compression_gathering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        At the current time the netCDF interface does not provide for packing</span>
<span class="sd">        data. However a simple packing may be achieved through the use of the</span>
<span class="sd">        optional NUG defined attributes scale_factor and add_offset . After the</span>
<span class="sd">        data values of a variable have been read, they are to be multiplied by</span>
<span class="sd">        the scale_factor , and have add_offset added to them. If both</span>
<span class="sd">        attributes are present, the data are scaled before the offset is added.</span>
<span class="sd">        When scaled data are written, the application should first subtract the</span>
<span class="sd">        offset and then divide by the scale factor. The units of a variable</span>
<span class="sd">        should be representative of the unpacked data.</span>

<span class="sd">        This standard is more restrictive than the NUG with respect to the use</span>
<span class="sd">        of the scale_factor and add_offset attributes; ambiguities and</span>
<span class="sd">        precision problems related to data type conversions are resolved by</span>
<span class="sd">        these restrictions. If the scale_factor and add_offset attributes are</span>
<span class="sd">        of the same data type as the associated variable, the unpacked data is</span>
<span class="sd">        assumed to be of the same data type as the packed data. However, if the</span>
<span class="sd">        scale_factor and add_offset attributes are of a different data type</span>
<span class="sd">        from the variable (containing the packed data) then the unpacked data</span>
<span class="sd">        should match the type of these attributes, which must both be of type</span>
<span class="sd">        float or both be of type double . An additional restriction in this</span>
<span class="sd">        case is that the variable containing the packed data must be of type</span>
<span class="sd">        byte , short or int . It is not advised to unpack an int into a float</span>
<span class="sd">        as there is a potential precision loss.</span>

<span class="sd">        When data to be packed contains missing values the attributes that</span>
<span class="sd">        indicate missing values ( _FillValue , valid_min , valid_max ,</span>
<span class="sd">                                 valid_range ) must be of the same data type as</span>
<span class="sd">        the packed data. See Section 2.5.1, “Missing Data” for a discussion of</span>
<span class="sd">        how applications should treat variables that have attributes indicating</span>
<span class="sd">        both missing values and transformations defined by a scale and/or</span>
<span class="sd">        offset.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">compress_var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span>
            <span class="n">compress</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">reasoning</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># puts the referenced variable being compressed into a set</span>
            <span class="n">compress_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">compress_var</span><span class="o">.</span><span class="n">compress</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">compress_var</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Compression variable </span><span class="si">{</span><span class="n">compress_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> may only have one dimension&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># IMPLEMENTATION CONFORMANCE 8.2 REQUIRED 1/3</span>
            <span class="c1"># ensure compression variable is a proper index, and thus is an</span>
            <span class="c1"># signed or unsigned integer type of some sort</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">compress_var</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">compress_var</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">}</span>
            <span class="p">):</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Compression variable </span><span class="si">{</span><span class="n">compress_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be an integer type to form a proper array index&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># IMPLEMENTATION CONFORMANCE 8.2 REQUIRED 2/3</span>
            <span class="c1"># make sure all the variables referred to are contained by the</span>
            <span class="c1"># variables.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">compress_set</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">dimensions</span><span class="p">):</span>
                <span class="n">not_in_dims</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">compress_set</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">dimensions</span><span class="p">))</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The following dimensions referenced by the compress attribute of variable </span><span class="si">{</span><span class="n">compress_var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> do not exist: </span><span class="si">{</span><span class="n">not_in_dims</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># IMPLEMENTATION CONFORMANCE 8.2 REQUIRED 3/3</span>
            <span class="c1"># The values of the associated coordinate variable must be in the range</span>
            <span class="c1"># starting with 0 and going up to the product of the compressed dimension</span>
            <span class="c1"># sizes minus 1 (CDL index conventions).</span>

            <span class="c1"># Put the the values of the associated coordinate variable into a list</span>
            <span class="n">coord_list_size</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">item</span><span class="o">.</span><span class="n">size</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">compress_set</span>
            <span class="p">]</span>
            <span class="c1"># get the upper limit of the dimenssion size</span>
            <span class="n">upper_limit_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">coord_list_size</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">coord_size</span> <span class="ow">in</span> <span class="n">coord_list_size</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">coord_size</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_limit_size</span><span class="p">):</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">reasoning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The dimenssion size </span><span class="si">{</span><span class="n">coord_size</span><span class="si">}</span><span class="s2"> referenced by the compress attribute is not &quot;</span>
                        <span class="s2">&quot;in the range (0, The product of the compressed dimension sizes minus 1)&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">valid</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;8.2&quot;</span><span class="p">],</span>
                <span class="n">reasoning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="c1">###############################################################################</span>
    <span class="c1"># Chapter 9: Discrete Sampling Geometries</span>
    <span class="c1">###############################################################################</span>

<div class="viewcode-block" id="CF1_6Check.check_feature_type">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_feature_type">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_feature_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the global attribute featureType for valid CF featureTypes</span>

<span class="sd">        9.4 A global attribute, featureType, is required for all Discrete Geometry representations except the orthogonal</span>
<span class="sd">        multidimensional array representation, for which it is highly recommended.</span>

<span class="sd">        The value assigned to the featureType attribute is case-insensitive.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Due to case insensitive requirement, we list the possible featuretypes</span>
        <span class="c1"># in lower case and check using the .lower() method</span>
        <span class="n">feature_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;point&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timeseries&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trajectory&quot;</span><span class="p">,</span>
            <span class="s2">&quot;profile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timeseriesprofile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trajectoryprofile&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">feature_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s2">&quot;featureType&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">valid_feature_type</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span>
            <span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="s2">&quot;§9.1 Dataset contains a valid featureType&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">valid_feature_type</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="n">feature_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">feature_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a valid CF featureType. It must be one of </span><span class="si">{}</span><span class="s2">&quot;</span>
            <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature_type</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">feature_list</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">valid_feature_type</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span></div>


<div class="viewcode-block" id="CF1_6Check.check_cf_role">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_cf_role">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_cf_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check variables defining cf_role for legal cf_role values.</span>

<span class="sd">        §9.5 The only acceptable values of cf_role for Discrete Geometry CF</span>
<span class="sd">        data sets are timeseries_id, profile_id, and trajectory_id</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: compliance_checker.base.Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_roles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;timeseries_id&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_id&quot;</span><span class="p">,</span> <span class="s2">&quot;trajectory_id&quot;</span><span class="p">]</span>
        <span class="n">variable_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_cf_role</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;9.5&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_variables_by_attributes</span><span class="p">(</span><span class="n">cf_role</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">variable_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">cf_role</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">cf_role</span>
            <span class="n">valid_cf_role</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">cf_role</span> <span class="ow">in</span> <span class="n">valid_roles</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a valid cf_role value. It must be one of </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cf_role</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_roles</span><span class="p">)),</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">variable_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valid_cf_role</span><span class="o">.</span><span class="n">to_result</span><span class="p">()</span></div>


<div class="viewcode-block" id="CF1_6Check.check_variable_features">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_variable_features">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_variable_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the variable feature types match the dataset featureType attribute.</span>
<span class="sd">        If more than one unique feature type is found, report this as an error.</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feature_types_found</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">feature_list</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;point&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timeseries&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trajectory&quot;</span><span class="p">,</span>
            <span class="s2">&quot;profile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timeseriesprofile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trajectoryprofile&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Don&#39;t bother checking if it&#39;s not a legal featureType</span>
        <span class="c1"># if the featureType attribute doesn&#39;t exist</span>
        <span class="n">feature_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s2">&quot;featureType&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">feature_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">feature_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">_feature</span> <span class="o">=</span> <span class="n">feature_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_geophysical_vars</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
            <span class="n">variable_feature</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">guess_feature_type</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="c1"># If we can&#39;t figure it out, don&#39;t check it.</span>
            <span class="k">if</span> <span class="n">variable_feature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">feature_types_found</span><span class="p">[</span><span class="n">variable_feature</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">matching_feature</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;9.1&quot;</span><span class="p">])</span>
            <span class="n">matching_feature</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
                <span class="n">variable_feature</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">_feature</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a </span><span class="si">{</span><span class="n">_feature</span><span class="si">}</span><span class="s2">, it is detected as a </span><span class="si">{</span><span class="n">variable_feature</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matching_feature</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="c1"># create explanation of all of the different featureTypes</span>
        <span class="c1"># found in the dataset</span>
        <span class="n">feature_description</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ftr</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vrs</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">ftr</span><span class="p">,</span> <span class="n">vrs</span> <span class="ow">in</span> <span class="n">feature_types_found</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="n">all_same_features</span> <span class="o">=</span> <span class="n">TestCtx</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;9.1&quot;</span><span class="p">])</span>
        <span class="n">all_same_features</span><span class="o">.</span><span class="n">assert_true</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">feature_types_found</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Different feature types discovered in this dataset: </span><span class="si">{</span><span class="n">feature_description</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_same_features</span><span class="o">.</span><span class="n">to_result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


<div class="viewcode-block" id="CF1_6Check.check_hints">
<a class="viewcode-back" href="../../../generated/compliance_checker.cf.CF1_6Check.html#compliance_checker.cf.CF1_6Check.check_hints">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_hints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for potentially mislabeled metadata and makes suggestions for how to correct</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">ret_val</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_hint_bounds</span><span class="p">(</span><span class="n">ds</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_hint_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for variables ending with _bounds, if they are not cell methods,</span>
<span class="sd">        make the recommendation</span>

<span class="sd">        :param netCDF4.Dataset ds: An open netCDF dataset</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :return: List of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">boundary_variables</span> <span class="o">=</span> <span class="n">cfutil</span><span class="o">.</span><span class="n">get_cell_boundary_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_bounds&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">boundary_variables</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> might be a cell boundary variable but there are no variables that define it &quot;</span>
                    <span class="s2">&quot;as a boundary using the `bounds` attribute.&quot;</span>
                <span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">BaseCheck</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_titles</span><span class="p">[</span><span class="s2">&quot;7.1&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">msg</span><span class="p">])</span>
                <span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_val</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Dave Foster.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>